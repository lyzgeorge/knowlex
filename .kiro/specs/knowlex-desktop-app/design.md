# Knowlex æ¡Œé¢æ™ºèƒ½åŠ©ç† - æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

Knowlex æ˜¯ä¸€æ¬¾åŸºäº Electron + React çš„è·¨å¹³å°æ¡Œé¢æ™ºèƒ½åŠ©ç†åº”ç”¨ï¼Œé›†æˆäº†å¯¹è¯å¼ AIã€é¡¹ç›®ç®¡ç†ã€æ–‡ä»¶å¤„ç†å’Œä¸ªæ€§åŒ–çŸ¥è¯†è®°å¿†åŠŸèƒ½ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†åº”ç”¨çš„æŠ€æœ¯æ¶æ„ã€ç»„ä»¶è®¾è®¡å’Œå®ç°æ–¹æ¡ˆã€‚

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯

- **å‰ç«¯æ¡†æ¶**: React 18 + TypeScript
- **æ¡Œé¢æ¡†æ¶**: Electron (æœ€æ–°ç¨³å®šç‰ˆ)
- **AI SDK**: OpenAI Agents JS SDK
- **æ•°æ®åº“**: SQLite (å…ƒæ•°æ®) + hnswsqlite (å‘é‡å­˜å‚¨)
- **UI ç»„ä»¶åº“**: Chakra UI
- **çŠ¶æ€ç®¡ç†**: Zustand
- **æ ·å¼æ–¹æ¡ˆ**: Tailwind CSS + Chakra UI

### å¼€å‘å·¥å…·

- **æ„å»ºå·¥å…·**: Vite
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **ç±»å‹æ£€æŸ¥**: TypeScript
- **æµ‹è¯•æ¡†æ¶**: Jest + React Testing Library
- **æ‰“åŒ…å·¥å…·**: Electron Builder
- **Monorepo ç®¡ç†**: pnpm workspace
- **å…±äº«ç±»å‹åŒ…**: @knowlex/types (å†…éƒ¨åŒ…)

### å¥‘çº¦ç‰ˆæœ¬åŒ–

- **IPC é€šé“ç‰ˆæœ¬**: é‡‡ç”¨ semver æ ‡ç­¾ (v1.0.0, v1.1.0)
- **æ•°æ®åº“ Schema ç‰ˆæœ¬**: ç‰ˆæœ¬å­—æ®µ + è¿ç§»è„šæœ¬
- **API æ¥å£ç‰ˆæœ¬**: ç‰ˆæœ¬åŒ–çš„ç±»å‹å®šä¹‰å’Œ changelog
- **å˜æ›´ç®¡ç†**: è‡ªåŠ¨ç”Ÿæˆ changelogï¼Œæ¥å£æ¼”è¿›å¯è¿½æº¯

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "Electron Main Process"
        A[Main Process] --> B[Window Manager]
        A --> C[Database Manager]
        A --> D[File System Manager]
        A --> E[IPC Handler]
    end

    subgraph "Electron Renderer Process"
        F[React App] --> G[UI Components]
        F --> H[State Management]
        F --> I[API Services]
        F --> J[IPC Client]
    end

    subgraph "Data Layer"
        K[SQLite Database] --> L[Metadata Tables]
        M[hnswsqlite] --> N[Vector Storage]
        O[File System] --> P[Source Files]
        O --> Q[PDF/A Files]
        R[Worker Threads] --> S[File Processing]
        R --> T[Vector Embedding]
    end

    subgraph "External Services"
        R[OpenAI Compatible API]
        S[Embedding API]
    end

    E <--> J
    C --> K
    C --> M
    D --> O
    I --> R
    I --> S
```

### è¿›ç¨‹æ¶æ„

#### Main Process (Node.js)

- **èŒè´£**: çª—å£ç®¡ç†ã€æ•°æ®åº“æ“ä½œã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€ç³»ç»Ÿçº§åŠŸèƒ½ã€Worker è¿›ç¨‹ç®¡ç†
- **æ ¸å¿ƒæ¨¡å—**:
  - `WindowManager`: ç®¡ç†åº”ç”¨çª—å£
  - `DatabaseManager`: SQLite å’Œ hnswsqlite æ“ä½œ
  - `FileManager`: æ–‡ä»¶ä¸Šä¼ ã€è½¬æ¢ã€å­˜å‚¨ï¼ˆè½»é‡çº§æ“ä½œï¼‰
  - `WorkerManager`: ç®¡ç† Worker çº¿ç¨‹ï¼ˆé‡å‹æ–‡ä»¶å¤„ç†å’Œå‘é‡åŒ–ï¼‰
  - `IPCHandler`: è¿›ç¨‹é—´é€šä¿¡å¤„ç†

#### Worker Threads (Node.js)

- **èŒè´£**: é‡å‹æ–‡ä»¶å¤„ç†ã€PDF è½¬æ¢ã€å‘é‡åŒ–è®¡ç®—
- **æ ¸å¿ƒæ¨¡å—**:
  - `FileProcessor`: å¤§æ–‡ä»¶å¤„ç†å’Œ PDF/A è½¬æ¢
  - `EmbeddingProcessor`: æ–‡æœ¬å‘é‡åŒ–å¤„ç†
  - `TaskQueue`: ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†

#### Renderer Process (React)

- **èŒè´£**: ç”¨æˆ·ç•Œé¢ã€ç”¨æˆ·äº¤äº’ã€çŠ¶æ€ç®¡ç†
- **æ ¸å¿ƒæ¨¡å—**:
  - `UIComponents`: React ç»„ä»¶
  - `StateStore`: Zustand çŠ¶æ€ç®¡ç†
  - `APIService`: OpenAI Agents JS é›†æˆ
  - `IPCClient`: ä¸ä¸»è¿›ç¨‹é€šä¿¡

## æ•°æ®æ¨¡å‹è®¾è®¡

### SQLite æ•°æ®åº“ç»“æ„

```sql
-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ä¼šè¯è¡¨
CREATE TABLE conversations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL DEFAULT 'Untitled Chat',
    project_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE SET NULL
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    conversation_id INTEGER NOT NULL,
    role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system', 'tool')),
    content TEXT NOT NULL,
    file_references TEXT, -- JSON æ•°ç»„å­˜å‚¨æ–‡ä»¶å¼•ç”¨ ID
    tool_calls TEXT, -- JSON æ ¼å¼å­˜å‚¨å·¥å…·è°ƒç”¨ä¿¡æ¯
    metadata TEXT, -- JSON æ ¼å¼å­˜å‚¨å…¶ä»–å…ƒæ•°æ®
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
);

-- æ–‡ä»¶è¡¨
CREATE TABLE files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    filename TEXT NOT NULL,
    original_path TEXT NOT NULL,
    pdf_path TEXT NOT NULL,
    file_size INTEGER NOT NULL,
    md5_original TEXT NOT NULL,
    md5_pdf TEXT NOT NULL,
    status TEXT NOT NULL DEFAULT 'processing' CHECK (status IN ('processing', 'completed', 'failed')),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- é¡¹ç›®è®°å¿†è¡¨
CREATE TABLE project_memories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    type TEXT NOT NULL DEFAULT 'memory' CHECK (type IN ('memory', 'description')),
    is_system BOOLEAN DEFAULT FALSE, -- ç³»ç»Ÿç”Ÿæˆçš„è®°å¿†ï¼ˆå¦‚é¡¹ç›®æè¿°ï¼‰ä¸å¯åˆ é™¤
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- é¡¹ç›®çŸ¥è¯†è¡¨
CREATE TABLE project_knowledge (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- åº”ç”¨è®¾ç½®è¡¨
CREATE TABLE app_settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- å‘é‡å­˜å‚¨è¡¨ï¼ˆä½¿ç”¨ hnswsqliteï¼‰
CREATE VIRTUAL TABLE IF NOT EXISTS vector_documents USING hnsw(
    id TEXT PRIMARY KEY,
    file_id INTEGER,
    project_id INTEGER,
    chunk_index INTEGER,
    content TEXT,
    filename TEXT,
    chunk_start INTEGER,
    chunk_end INTEGER,
    created_at TEXT,
    embedding(768) -- å‘é‡ç»´åº¦ï¼Œæ ¹æ®å®é™… embedding æ¨¡å‹è°ƒæ•´
);

-- é‡æ’æ¨¡å‹é…ç½®
CREATE TABLE rerank_settings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    model_name TEXT NOT NULL,
    api_key TEXT,
    base_url TEXT,
    enabled BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_conversations_project_id ON conversations(project_id);
CREATE INDEX idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX idx_files_project_id ON files(project_id);
CREATE INDEX idx_project_memories_project_id ON project_memories(project_id);
CREATE INDEX idx_project_knowledge_project_id ON project_knowledge(project_id);
```

### hnswsqlite å‘é‡å­˜å‚¨ç»“æ„

```typescript
interface VectorDocument {
  id: string // å”¯ä¸€æ ‡è¯†ç¬¦
  file_id: number // å…³è”çš„æ–‡ä»¶ ID
  project_id: number // å…³è”çš„é¡¹ç›® ID
  chunk_index: number // æ–‡æœ¬å—ç´¢å¼•
  content: string // åŸå§‹æ–‡æœ¬å†…å®¹
  filename: string // æ–‡ä»¶å
  chunk_start: number // æ–‡æœ¬å—å¼€å§‹ä½ç½®
  chunk_end: number // æ–‡æœ¬å—ç»“æŸä½ç½®
  created_at: string // åˆ›å»ºæ—¶é—´
  embedding: number[] // å‘é‡è¡¨ç¤ºï¼ˆç”± hnswsqlite å¤„ç†ï¼‰
}

interface RerankResult {
  document: VectorDocument
  score: number
  relevance_score: number // é‡æ’åçš„ç›¸å…³æ€§åˆ†æ•°
}
```

## ç»„ä»¶æ¶æ„è®¾è®¡

### å‰ç«¯ç»„ä»¶å±‚æ¬¡ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx           # å·¦ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ MainContent.tsx       # å³ä¾§ä¸»å†…å®¹åŒº
â”‚   â”‚   â””â”€â”€ Layout.tsx            # æ•´ä½“å¸ƒå±€
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ChatInterface.tsx     # èŠå¤©ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx       # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx      # æ¶ˆæ¯è¾“å…¥æ¡†
â”‚   â”‚   â””â”€â”€ FileUpload.tsx        # æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx       # é¡¹ç›®åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ ProjectOverview.tsx   # é¡¹ç›®æ¦‚è§ˆ
â”‚   â”‚   â”œâ”€â”€ FileManager.tsx       # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â””â”€â”€ MemoryKnowledge.tsx   # è®°å¿†ä¸çŸ¥è¯†ç®¡ç†
â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”œâ”€â”€ GlobalSearch.tsx      # å…¨å±€æœç´¢
â”‚   â”‚   â””â”€â”€ SearchResults.tsx     # æœç´¢ç»“æœ
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”œâ”€â”€ SettingsPanel.tsx     # è®¾ç½®é¢æ¿
â”‚   â”‚   â”œâ”€â”€ APIConfig.tsx         # API é…ç½®
â”‚   â”‚   â””â”€â”€ ThemeSelector.tsx     # ä¸»é¢˜é€‰æ‹©å™¨
â”‚   â””â”€â”€ common/
â”‚       â”œâ”€â”€ Modal.tsx             # é€šç”¨æ¨¡æ€æ¡†
â”‚       â”œâ”€â”€ Button.tsx            # é€šç”¨æŒ‰é’®
â”‚       â””â”€â”€ Loading.tsx           # åŠ è½½ç»„ä»¶
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ openai.service.ts     # OpenAI API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ embedding.service.ts  # å‘é‡åŒ–æœåŠ¡
â”‚   â”‚   â””â”€â”€ ipc.service.ts        # IPC é€šä¿¡æœåŠ¡
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ sqlite.service.ts     # SQLite æ“ä½œ
â”‚   â”‚   â””â”€â”€ vector.service.ts     # å‘é‡æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ file/
â”‚   â”‚   â””â”€â”€ file.service.ts       # æ–‡ä»¶å¤„ç†æœåŠ¡
â”‚   â””â”€â”€ mock/
â”‚       â”œâ”€â”€ ipc.mock.ts           # IPC Mock æœåŠ¡
â”‚       â”œâ”€â”€ openai.mock.ts        # OpenAI Mock æœåŠ¡
â”‚       â””â”€â”€ database.mock.ts      # æ•°æ®åº“ Mock æœåŠ¡
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ app.store.ts              # åº”ç”¨å…¨å±€çŠ¶æ€
â”‚   â”œâ”€â”€ chat.store.ts             # èŠå¤©çŠ¶æ€
â”‚   â”œâ”€â”€ project.store.ts          # é¡¹ç›®çŠ¶æ€
â”‚   â””â”€â”€ settings.store.ts         # è®¾ç½®çŠ¶æ€
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ api.types.ts              # API ç±»å‹å®šä¹‰ (å¼•ç”¨ @knowlex/types)
â”‚   â”œâ”€â”€ database.types.ts         # æ•°æ®åº“ç±»å‹å®šä¹‰ (å¼•ç”¨ @knowlex/types)
â”‚   â””â”€â”€ app.types.ts              # åº”ç”¨ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ constants.ts              # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ helpers.ts                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ validation.ts             # æ•°æ®éªŒè¯
â””â”€â”€ i18n/
    â”œâ”€â”€ index.ts                  # å›½é™…åŒ–é…ç½®
    â”œâ”€â”€ locales/
    â”‚   â”œâ”€â”€ en.json              # è‹±æ–‡è¯­è¨€åŒ…
    â”‚   â””â”€â”€ zh.json              # ä¸­æ–‡è¯­è¨€åŒ…
    â””â”€â”€ hooks/
        â””â”€â”€ useTranslation.ts     # ç¿»è¯‘ Hook
```

### å…±äº«ç±»å‹åŒ…ç»“æ„

```
packages/
â””â”€â”€ types/
    â”œâ”€â”€ package.json              # @knowlex/types åŒ…é…ç½®
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ ipc.types.ts          # IPC é€šé“ç±»å‹å®šä¹‰
    â”‚   â”œâ”€â”€ database.types.ts     # æ•°æ®åº“ Schema ç±»å‹
    â”‚   â”œâ”€â”€ api.types.ts          # API æ¥å£ç±»å‹
    â”‚   â”œâ”€â”€ common.types.ts       # é€šç”¨ç±»å‹å®šä¹‰
    â”‚   â””â”€â”€ index.ts              # ç±»å‹å¯¼å‡ºå…¥å£
    â”œâ”€â”€ CHANGELOG.md              # ç±»å‹å˜æ›´æ—¥å¿—
    â””â”€â”€ README.md                 # ç±»å‹åŒ…æ–‡æ¡£
```

### åç«¯æœåŠ¡å±‚æ¬¡ç»“æ„

```
src-electron/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ index.ts                  # ä¸»è¿›ç¨‹å…¥å£
â”‚   â”œâ”€â”€ window.ts                 # çª—å£ç®¡ç†
â”‚   â””â”€â”€ menu.ts                   # èœå•é…ç½®
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ sqlite.manager.ts     # SQLite ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ vector.manager.ts     # hnswsqlite ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ migration.ts          # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ schema.version.ts     # Schema ç‰ˆæœ¬ç®¡ç†
â”‚   â”œâ”€â”€ file/
â”‚   â”‚   â”œâ”€â”€ file.manager.ts       # æ–‡ä»¶ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ pdf.converter.ts      # PDF è½¬æ¢å™¨
â”‚   â”‚   â””â”€â”€ storage.manager.ts    # å­˜å‚¨ç®¡ç†å™¨
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ openai.client.ts      # OpenAI å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ embedding.client.ts   # å‘é‡åŒ–å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ rerank.client.ts      # é‡æ’æ¨¡å‹å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ rag.service.ts        # RAG æœåŠ¡
â”‚   â””â”€â”€ search/
â”‚       â””â”€â”€ fulltext.service.ts   # å…¨æ–‡æœç´¢æœåŠ¡
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ base.handler.ts           # åŸºç¡€å¤„ç†å™¨ (ç‰ˆæœ¬åŒ–æ”¯æŒ)
â”‚   â”œâ”€â”€ chat.handler.ts           # èŠå¤©å¤„ç†å™¨
â”‚   â”œâ”€â”€ project.handler.ts        # é¡¹ç›®å¤„ç†å™¨
â”‚   â”œâ”€â”€ file.handler.ts           # æ–‡ä»¶å¤„ç†å™¨
â”‚   â””â”€â”€ settings.handler.ts       # è®¾ç½®å¤„ç†å™¨
â”œâ”€â”€ workers/
â”‚   â”œâ”€â”€ file-processor.worker.ts  # æ–‡ä»¶å¤„ç† Worker Thread
â”‚   â”œâ”€â”€ embedding.worker.ts       # å‘é‡åŒ– Worker Thread
â”‚   â””â”€â”€ task-queue.worker.ts      # ä»»åŠ¡é˜Ÿåˆ— Worker Thread
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ ipc.types.ts              # IPC ç±»å‹å®šä¹‰ (å¼•ç”¨ @knowlex/types)
â”‚   â”œâ”€â”€ database.types.ts         # æ•°æ®åº“ç±»å‹å®šä¹‰ (å¼•ç”¨ @knowlex/types)
â”‚   â””â”€â”€ worker.types.ts           # Worker çº¿ç¨‹ç±»å‹å®šä¹‰
â””â”€â”€ utils/
    â”œâ”€â”€ logger.ts                 # æ—¥å¿—å·¥å…·
    â”œâ”€â”€ crypto.ts                 # åŠ å¯†å·¥å…·
    â”œâ”€â”€ path.helper.ts            # è·¯å¾„å·¥å…·
    â””â”€â”€ version.helper.ts         # ç‰ˆæœ¬ç®¡ç†å·¥å…·
```

## é¡µé¢åŸå‹è®¾è®¡

### 1. ä¸»ç•Œé¢ï¼šæ–°å»ºèŠå¤© / æœªå½’ç±»èŠå¤© (Home / New Chat / Uncategorized Chat)



è¿™æ˜¯åº”ç”¨å¯åŠ¨æˆ–ç‚¹å‡»â€œ+ New Chatâ€æ—¶æ˜¾ç¤ºçš„åˆå§‹ç•Œé¢ã€‚å·¦ä¾§ä¸ºå›ºå®šå®½åº¦å¯¼èˆªæ ï¼Œå³ä¾§ä¸ºä¸»å†…å®¹åŒºã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ  (260px)               | | ä¸»å†…å®¹åŒº (è‡ªé€‚åº”å®½åº¦)                                        |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat (å§‹ç»ˆç½®é¡¶)          | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A                  | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats (æœªå½’ç±»èŠå¤©)           | |                                                            |
| |   - Untitled Chat (å½“å‰ä¼šè¯)   | |                                                            |
| |   - Chat å†å² 1                | |                                                            |
| |   - Chat å†å² 2                | |                                                            |
| |                                | |                                                            |
| |                                | |         "ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"                       |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |         "å¯ä»¥ä¸Šä¼  TXT æˆ– MD æ–‡ä»¶å¼€å§‹ã€‚"                   |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡]                  | |                                                            |
| +--------------------------------+ |                                                            |
|                                  | |                                                            |
|                                  | |                                                            |
|                                  | | +--------------------------------------------------------+ |
|                                  | | | [ğŸ“ æ–‡ä»¶ä¸Šä¼ å›¾æ ‡] è¾“å…¥æ¶ˆæ¯...                          | |
|                                  | | |                                     [â¡ï¸ å‘é€æŒ‰é’®]      | |
|                                  | | +--------------------------------------------------------+ |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 2. å…¨å±€æœç´¢æ¨¡æ€æ¡† (Global Search Modal)



ç‚¹å‡»å·¦ä¾§è¾¹æ çš„â€œå…¨å±€æœç´¢â€å›¾æ ‡æ—¶å¼¹å‡ºçš„å±…ä¸­æ¨¡æ€æ¡†ã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | ...                            | |                                                            |
| |                                | |                                                            |
| |                                | |        +----------------------------------------+          |
| |                                | |        |            å…¨å±€æœç´¢                  [X]|          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | [ğŸ”] æœç´¢å…³é”®è¯...                       |          |
| |                                | |        |----------------------------------------|          |
| |                                | |        |                                        |          |
| |                                | |        | ä¼šè¯æ ‡é¢˜ 1                               |          |
| |                                | |        |   - åŒ…å«[å…³é”®è¯]çš„ä¸Šä¸‹æ–‡æ‘˜è¦...          |          |
| |                                | |        |   - æ‰€å±é¡¹ç›®: Project A                  |          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | ä¼šè¯æ ‡é¢˜ 2                               |          |
| |                                | |        |   - åŒ…å«[å…³é”®è¯]çš„ä¸Šä¸‹æ–‡æ‘˜è¦...          |          |
| |                                | |        |   - æ‰€å±é¡¹ç›®: (æœªå½’ç±»)                   |          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | ... (æŒ‰æ›´æ–°æ—¶é—´å€’åºï¼Œæ— é™æ»šåŠ¨)         |          |
| |                                | |        +----------------------------------------+          |
| | ...                            | |                                                            |
| +--------------------------------+ +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 3. æ–°å»ºé¡¹ç›®æ¨¡æ€æ¡† (New Project Modal)



ç‚¹å‡»å·¦ä¾§è¾¹æ â€œProjectsâ€æ—è¾¹çš„â€œ+â€æŒ‰é’®æ—¶å¼¹å‡ºçš„æ¨¡æ€æ¡†ã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | ...                            | |                                                            |
| |                                | |                                                            |
| |                                | |        +----------------------------------------+          |
| |                                | |        |            æ–°å»ºé¡¹ç›®                  [X]|          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | é¡¹ç›®åç§°:                               |          |
| |                                | |        | [_____________________________________] |          |
| |                                | |        |                                        |          |
| |                                | |        | é¡¹ç›®æè¿° (å¯é€‰):                         |          |
| |                                | |        | [_____________________________________] |          |
| |                                | |        | (æœ€å¤š200å­—ç¬¦ï¼Œç¦æ­¢æ¢è¡Œ)                |          |
| |                                | |        |                                        |          |
| |                                | |        |                                        |          |
| |                                | |        |            [å–æ¶ˆ]    [åˆ›å»º]            |          |
| |                                | |        +----------------------------------------+          |
| | ...                            | |                                                            |
| +--------------------------------+ +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 4. é¡¹ç›®æ¦‚è§ˆé¡µ (Project Overview Page)



ç‚¹å‡»å·¦ä¾§è¾¹æ ä¸­çš„é¡¹ç›®åç§°æ—¶æ˜¾ç¤ºæ­¤é¡µé¢ã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat                     | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A (å½“å‰é€‰ä¸­)       | |                                                            |
| |     - Chat 1                   | |                                                            |
| |     - Chat 2                   | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats                        | |                                                            |
| |   - Chat å†å² 3                | |                                                            |
| |                                | |                                                            |
| |                                | |                 [Project A]                                |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |                 (é¡¹ç›®æ¦‚è§ˆ)                                 |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡]                  | |                                                            |
| +--------------------------------+ |                                                            |
|                                  | |                                                            |
|                                  | | +--------------------------------------------------------+ |
|                                  | | | [ğŸ“ æ–‡ä»¶ä¸Šä¼ å›¾æ ‡] è¾“å…¥æ¶ˆæ¯...                          | |
|                                  | | | (æ–°ä¼šè¯å°†è‡ªåŠ¨å½’å…¥ Project A)                           | |
|                                  | | |                                     [â¡ï¸ å‘é€æŒ‰é’®]      | |
|                                  | | +--------------------------------------------------------+ |
|                                  | |                                                            |
|                                  | | +---------------------+   +---------------------+        |
|                                  | | |    [é¡¹ç›®æ–‡ä»¶]       |   |   [è®°å¿†ä¸çŸ¥è¯†]      |        |
|                                  | | +---------------------+   +---------------------+        |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 5. é¡¹ç›®èŠå¤©é¡µ (Project Chat Page)



ç‚¹å‡»é¡¹ç›®ä¸‹çš„æŸä¸ªä¼šè¯æ—¶æ˜¾ç¤ºæ­¤é¡µé¢ã€‚åŒ…å« RAG å¼•ç”¨å’Œâ€œå­˜ä¸ºçŸ¥è¯†â€æ‚¬æµ®æŒ‰é’®æç¤ºã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat                     | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A (å½“å‰é€‰ä¸­)       | |                                                            |
| |     - Chat 1 (å½“å‰ä¼šè¯)        | |                                                            |
| |     - Chat 2                   | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats                        | |                                                            |
| |   - Chat å†å² 3                | |                                                            |
| |                                | |                                                            |
| |                                | |                 [Chat 1 æ ‡é¢˜]                              |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |                                                            |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡]                  | |                                                            |
| +--------------------------------+ |                                                            |
|                                  | |   ç”¨æˆ·: è¿™æ˜¯ä¸€ä¸ªå…³äºäººå·¥æ™ºèƒ½çš„é—®é¢˜ã€‚                       |
|                                  | |                                                            |
|                                  | |   AI: äººå·¥æ™ºèƒ½æ˜¯...                                        |
|                                  | |       (å½“ç”¨æˆ·é€‰æ‹©æ–‡å­—æ—¶ï¼Œå³ä¸Šè§’æµ®ç° "[å­˜ä¸ºçŸ¥è¯†] ğŸ’¡")     |
|                                  | |                                                            |
|                                  | |   å¼•ç”¨: [æ–‡ä»¶ A.txt] [æ–‡ä»¶ B.md]                           |
|                                  | |                                                            |
|                                  | | +--------------------------------------------------------+ |
|                                  | | | [ğŸ“ æ–‡ä»¶ä¸Šä¼ å›¾æ ‡] è¾“å…¥æ¶ˆæ¯...                          | |
|                                  | | |                                     [â¡ï¸ å‘é€æŒ‰é’®]      | |
|                                  | | +--------------------------------------------------------+ |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 6. é¡¹ç›®æ–‡ä»¶ç®¡ç†é¡µ (Project File Management Page)



ç‚¹å‡»é¡¹ç›®åˆ—è¡¨ä¸­çš„æ–‡ä»¶ç®¡ç†å›¾æ ‡æˆ–é¡¹ç›®æ¦‚è§ˆé¡µçš„â€œé¡¹ç›®æ–‡ä»¶â€æŒ‰é’®æ—¶æ˜¾ç¤ºã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat                     | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A (å½“å‰é€‰ä¸­)       | |                                                            |
| |     - Chat 1                   | |                                                            |
| |     - Chat 2                   | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats                        | |                                                            |
| |   - Chat å†å² 3                | |                                                            |
| |                                | |                                                            |
| |                                | |                 [Project A]                                |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |                 (æ–‡ä»¶ç®¡ç†)                                 |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡]                  | |                                                            |
| +--------------------------------+ |                                                            |
|                                  | |                                        [â¬†ï¸ å¯¼å…¥æ–‡ä»¶]       |
|                                  | |                                                            |
|                                  | | +-------------------+  +-------------------+               |
|                                  | | | [æ–‡ä»¶ç¼©ç•¥å›¾]      |  | [æ–‡ä»¶ç¼©ç•¥å›¾]      |               |
|                                  | | | æ–‡ä»¶å A.txt      |  | æ–‡ä»¶å B.md       |               |
|                                  | | | åˆ›å»ºæ—¶é—´: YYYY-MM-DD|  | åˆ›å»ºæ—¶é—´: YYYY-MM-DD|               |
|                                  | | | å‘é‡åŒ–çŠ¶æ€: æˆåŠŸ  |  | å‘é‡åŒ–çŠ¶æ€: è¿›è¡Œä¸­..|               |
|                                  | | +-------------------+  +-------------------+               |
|                                  | |                                                            |
|                                  | | +-------------------+                                      |
|                                  | | | [æ–‡ä»¶ç¼©ç•¥å›¾]      |                                      |
|                                  | | | æ–‡ä»¶å C.txt      |                                      |
|                                  | | | åˆ›å»ºæ—¶é—´: YYYY-MM-DD|                                      |
|                                  | | | å‘é‡åŒ–çŠ¶æ€: å¤±è´¥  |                                      |
|                                  | | +-------------------+                                      |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 7. æ–‡ä»¶é¢„è§ˆ/ç¼–è¾‘æ¨¡æ€æ¡† (File Preview/Edit Modal)



æ­¤æ¨¡æ€æ¡†ç°åœ¨æ˜ç¡®æ˜¾ç¤ºå·¦ä¾§çš„â€œå†…å®¹â€å’Œâ€œå…ƒæ•°æ®â€æ ‡ç­¾é¡µï¼Œä»¥åŠå³ä¾§çš„ PDF/A é¢„è§ˆã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | ...                            | |                                                            |
| |                                | |                                                            |
| |                                | |        +----------------------------------------+          |
| |                                | |        |            æ–‡ä»¶é¢„è§ˆ/ç¼–è¾‘             [X]|          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | [å†…å®¹] | [å…ƒæ•°æ®]                      |          |
| |                                | |        |----------------------------------------|          |
| |                                | |        |                                        |          |
| |                                | |        | +-------------------+ +----------------+          |
| |                                | |        | | (å·¦ä¾§æ )          | | (å³ä¾§æ )       |          |
| |                                | |        | |                   | |                |          |
| |                                | |        | | **[å†…å®¹ Tab é€‰ä¸­]** | | **PDF/A é¢„è§ˆ** |          |
| |                                | |        | | å¯ç¼–è¾‘çš„æ–‡æœ¬å†…å®¹æ¡† | | (åªè¯»)         |          |
| |                                | |        | |                   | |                |          |
| |                                | |        | |                   | |                |          |
| |                                | |        | |                   | |                |          |
| |                                | |        | |                   | |                |          |
| |                                | |        | +-------------------+ +----------------+          |
| |                                | |        |                                        |          |
| |                                | |        |              [å–æ¶ˆ]    [ä¿å­˜]            |          |
| |                                | |        +----------------------------------------+          |
| | ...                            | |                                                            |
| +--------------------------------+ +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 8. é¡¹ç›®è®°å¿†ä¸çŸ¥è¯†é¡µ (Project Memory & Knowledge Page)



ç‚¹å‡»é¡¹ç›®åˆ—è¡¨ä¸­çš„è®°å¿†ä¸çŸ¥è¯†å›¾æ ‡æ—¶æ˜¾ç¤ºã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat                     | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A (å½“å‰é€‰ä¸­)       | |                                                            |
| |     - Chat 1                   | |                                                            |
| |     - Chat 2                   | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats                        | |                                                            |
| |   - Chat å†å² 3                | |                                                            |
| |                                | |                                                            |
| |                                | |                 [Project A]                                |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |                 (è®°å¿†ä¸çŸ¥è¯†)                               |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡]                  | |                                                            |
| +--------------------------------+ |                                                            |
|                                  | | +--------------------------------------------------------+ |
|                                  | | | è®°å¿† (Memory)                                 [+ æ–°å¢] | |
|                                  | | |--------------------------------------------------------| |
|                                  | | | - è®°å¿†æ¡ç›® 1 (ç¼–è¾‘/åˆ é™¤)                               | |
|                                  | | | - è®°å¿†æ¡ç›® 2 (ç¼–è¾‘/åˆ é™¤)                               | |
|                                  | | | ... (æœ€å¤š10æ¡)                                         | |
|                                  | | +--------------------------------------------------------+ |
|                                  | |                                                            |
|                                  | | +--------------------------------------------------------+ |
|                                  | | | çŸ¥è¯† (Knowledge)                              [+ æ–°å¢] | |
|                                  | | |--------------------------------------------------------| |
|                                  | | | +-----------------+ +-----------------+ +-------------+ |
|                                  | | | | çŸ¥è¯†å¡ç‰‡ 1      | | çŸ¥è¯†å¡ç‰‡ 2      | | çŸ¥è¯†å¡ç‰‡ 3  | |
|                                  | | | | (æ ‡é¢˜/æ‘˜è¦)     | | (æ ‡é¢˜/æ‘˜è¦)     | | (æ ‡é¢˜/æ‘˜è¦) | |
|                                  | | | | (ç¼–è¾‘/åˆ é™¤)     | | (ç¼–è¾‘/åˆ é™¤)     | | (ç¼–è¾‘/åˆ é™¤) | |
|                                  | | | +-----------------+ +-----------------+ +-------------+ |
|                                  | | | ... (å¡ç‰‡ç½‘æ ¼)                                         | |
|                                  | | +--------------------------------------------------------+ |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 9. çŸ¥è¯† Markdown ç¼–è¾‘å™¨æ¨¡æ€æ¡† (Knowledge Markdown Editor Modal)



æ–°å¢æˆ–ç¼–è¾‘çŸ¥è¯†å¡ç‰‡æ—¶å¼¹å‡ºçš„æ¨¡æ€æ¡†ã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | ...                            | |                                                            |
| |                                | |                                                            |
| |                                | |        +----------------------------------------+          |
| |                                | |        |            ç¼–è¾‘çŸ¥è¯†                  [X]|          |
| |                                | |        |----------------------------------------|          |
| |                                | |        | æ ‡é¢˜: [_______________________________] |          |
| |                                | |        |                                        |          |
| |                                | |        | Markdown å†…å®¹:                         |          |
| |                                | |        | +------------------------------------+ |          |
| |                                | |        | | # çŸ¥è¯†æ ‡é¢˜                           | |          |
| |                                | |        | |                                      | |          |
| |                                | |        | | è¿™æ˜¯çŸ¥è¯†çš„è¯¦ç»†å†…å®¹ï¼Œæ”¯æŒMarkdownæ ¼å¼ã€‚| |          |
| |                                | |        | |                                      | |          |
| |                                | |        | | - åˆ—è¡¨é¡¹ 1                           | |          |
| |                                | |        | | - åˆ—è¡¨é¡¹ 2                           | |          |
| |                                | |        | +------------------------------------+ |          |
| |                                | |        |                                        |          |
| |                                | |        |            [å–æ¶ˆ]    [ä¿å­˜]            |          |
| |                                | |        +----------------------------------------+          |
| | ...                            | |                                                            |
| +--------------------------------+ +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```



### 10. è®¾ç½®é¡µ (Settings Page)



ç‚¹å‡»å·¦ä¸‹è§’è®¾ç½®å›¾æ ‡æ—¶æ˜¾ç¤ºã€‚

```
+-------------------------------------------------------------------------------------------------+
| Knowlex                                                                                         |
|-------------------------------------------------------------------------------------------------|
| +--------------------------------+ +------------------------------------------------------------+
| | å·¦ä¾§è¾¹æ                        | | ä¸»å†…å®¹åŒº                                                   |
| |--------------------------------| |------------------------------------------------------------|
| | [Knowlex Logo]                 | |                                                            |
| |                                | |                                                            |
| | + New Chat                     | |                                                            |
| |                                | |                                                            |
| | [ğŸ” Global Search Icon]         | |                                                            |
| |                                | |                                                            |
| | > Projects (+)                 | |                                                            |
| |   - Project A                  | |                                                            |
| |   - Project B                  | |                                                            |
| |                                | |                                                            |
| | > Chats                        | |                                                            |
| |   - Chat å†å² 3                | |                                                            |
| |                                | |                                                            |
| |                                | |                 [è®¾ç½®]                                     |
| | [ğŸ‘¤ ç”¨æˆ·å¤´åƒ] [ç”¨æˆ·å]         | |                                                            |
| | [âš™ï¸ è®¾ç½®å›¾æ ‡] (å½“å‰é€‰ä¸­)       | |   [API é…ç½®] | [æ•°æ®ç®¡ç†] | [å¤–è§‚] | [å…³äº]             |
| +--------------------------------+ |------------------------------------------------------------|
|                                  | |                                                            |
|                                  | |   **API é…ç½®** |
|                                  | |   Chat API:                                                |
|                                  | |     Base URL: [_______________________________________]    |
|                                  | |     API Key:  [_______________________________________]    |
|                                  | |     Model Name: [_______________________________________]  |
|                                  | |     [æµ‹è¯•è¿æ¥]                                             |
|                                  | |                                                            |
|                                  | |   Embedding API:                                           |
|                                  | |     Base URL: [_______________________________________]    |
|                                  | |     API Key:  [_______________________________________]    |
|                                  | |     Model Name: [_______________________________________]  |
|                                  | |     Reranking Model Name: [____________________________]  |
|                                  | |     [æµ‹è¯•è¿æ¥]                                             |
|                                  | |                                                            |
|                                  | |   (åˆ‡æ¢æ ‡ç­¾é¡µæ˜¾ç¤ºå¯¹åº”å†…å®¹)                                 |
|                                  +------------------------------------------------------------+
+-------------------------------------------------------------------------------------------------+
```

## Mock/Stub æœåŠ¡è®¾è®¡

### è‡ªåŠ¨ç”Ÿæˆ Mock æœåŠ¡

ä¸ºäº†æå‡å¹¶è¡Œå¼€å‘æ•ˆç‡ï¼Œå‡å°‘"ç­‰æ¥å£"çš„æƒ…å†µï¼Œç³»ç»Ÿæä¾›è‡ªåŠ¨ç”Ÿæˆçš„ Mock æœåŠ¡ï¼š

```typescript
// src/services/mock/ipc.mock.ts
import { IPCChannels, IPCRequest, IPCResponse } from '@knowlex/types'

export class IPCMockService {
  private static instance: IPCMockService
  private mockData: Map<string, any> = new Map()

  static getInstance(): IPCMockService {
    if (!IPCMockService.instance) {
      IPCMockService.instance = new IPCMockService()
    }
    return IPCMockService.instance
  }

  // åŸºäº TypeScript æ¥å£è‡ªåŠ¨ç”Ÿæˆ Mock æ•°æ®
  async invoke<T extends keyof IPCChannels>(
    channel: T,
    data: IPCRequest<T>
  ): Promise<IPCResponse<T>> {
    // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
    await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 500))

    // æ ¹æ®é€šé“ç±»å‹è¿”å›é¢„è®¾çš„ Mock æ•°æ®
    switch (channel) {
      case 'chat:send-message':
        return this.mockChatResponse(data as any)
      case 'project:create':
        return this.mockProjectCreate(data as any)
      case 'file:upload':
        return this.mockFileUpload(data as any)
      default:
        return this.generateMockResponse(channel, data)
    }
  }

  private mockChatResponse(data: any): any {
    return {
      success: true,
      data: {
        id: `msg_${Date.now()}`,
        content: `Mock response for: ${data.message}`,
        role: 'assistant',
        timestamp: new Date().toISOString(),
      },
    }
  }

  // æ›´å¤š Mock æ–¹æ³•...
}

// src/services/mock/openai.mock.ts
export class OpenAIMockService {
  async sendMessage(message: string, stream: boolean = false) {
    if (stream) {
      return this.createMockStream(message)
    } else {
      return {
        finalOutput: `Mock AI response for: ${message}`,
        usage: { tokens: 150 },
      }
    }
  }

  private async* createMockStream(message: string) {
    const response = `Mock streaming response for: ${message}`
    const words = response.split(' ')

    for (const word of words) {
      yield { content: word + ' ', done: false }
      await new Promise(resolve => setTimeout(resolve, 50))
    }

    yield { content: '', done: true }
  }
}
```

### Mock æ•°æ®ç®¡ç†

```typescript
// src/services/mock/data.manager.ts
export class MockDataManager {
  private scenarios: Map<string, MockScenario> = new Map()

  // åŠ è½½é¢„å®šä¹‰çš„æµ‹è¯•åœºæ™¯
  loadScenarios() {
    this.scenarios.set('empty-project', {
      projects: [],
      conversations: [],
      files: [],
    })

    this.scenarios.set('sample-project', {
      projects: [
        {
          id: 1,
          name: 'Sample Project',
          created_at: '2024-01-01T00:00:00Z',
        },
      ],
      conversations: [
        {
          id: 1,
          title: 'Sample Chat',
          project_id: 1,
          messages: [
            {
              id: 1,
              role: 'user',
              content: 'Hello, how are you?',
            },
            {
              id: 2,
              role: 'assistant',
              content: 'I am doing well, thank you!',
            },
          ],
        },
      ],
      files: [],
    })
  }

  getScenario(name: string): MockScenario | undefined {
    return this.scenarios.get(name)
  }
}

interface MockScenario {
  projects: any[]
  conversations: any[]
  files: any[]
}
```

## CI/CD ä¸ä»£ç è´¨é‡é—¨ç¦

### ä»£ç è´¨é‡æ ‡å‡†

```yaml
# .github/workflows/quality-gate.yml
name: Quality Gate

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Type checking
        run: pnpm run type-check
      
      - name: Lint check
        run: pnpm run lint
        
      - name: Code formatting check
        run: pnpm run format:check
      
      - name: Unit tests
        run: pnpm run test:unit
        
      - name: Integration tests
        run: pnpm run test:integration
      
      - name: Coverage check
        run: pnpm run test:coverage
        env:
          COVERAGE_THRESHOLD: 80
      
      - name: Build check
        run: pnpm run build
      
      - name: Security audit
        run: pnpm audit --audit-level moderate

  cross-platform-build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - name: Setup and build
        run: |
          npm install -g pnpm
          pnpm install --frozen-lockfile
          pnpm run build:electron
```

### è´¨é‡é—¨ç¦é…ç½®

```json
// package.json
{
  "scripts": {
    "lint": "eslint src src-electron --ext .ts,.tsx --max-warnings 0",
    "lint:fix": "eslint src src-electron --ext .ts,.tsx --fix",
    "format:check": "prettier --check \"src/**/*.{ts,tsx}\" \"src-electron/**/*.ts\"",
    "format": "prettier --write \"src/**/*.{ts,tsx}\" \"src-electron/**/*.ts\"",
    "type-check": "tsc --noEmit && tsc --noEmit -p tsconfig.electron.json",
    "test:unit": "jest --testPathPattern=unit",
    "test:integration": "jest --testPathPattern=integration",
    "test:coverage": "jest --coverage --coverageThreshold='{\"global\":{\"branches\":80,\"functions\":80,\"lines\":80,\"statements\":80}}'",
    "test:e2e": "playwright test",
    "build": "vite build",
    "build:electron": "electron-builder",
    "security:audit": "pnpm audit --audit-level moderate"
  }
}
```

### åˆ†æ”¯ç­–ç•¥

```
main (ç”Ÿäº§åˆ†æ”¯)
â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/chat-interface
â”‚   â”œâ”€â”€ feature/file-upload
â”‚   â””â”€â”€ feature/rag-search
â”œâ”€â”€ release/v1.0.0 (å‘å¸ƒåˆ†æ”¯)
â””â”€â”€ hotfix/critical-bug (çƒ­ä¿®å¤åˆ†æ”¯)
```

**åˆ†æ”¯ä¿æŠ¤è§„åˆ™**ï¼š
- `main` åˆ†æ”¯ï¼šéœ€è¦ PR + 2äººå®¡æ ¸ + æ‰€æœ‰æ£€æŸ¥é€šè¿‡
- `develop` åˆ†æ”¯ï¼šéœ€è¦ PR + 1äººå®¡æ ¸ + åŸºç¡€æ£€æŸ¥é€šè¿‡
- è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼š`main` åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹

```yaml
# .github/workflows/release.yml
name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Build and sign
        run: |
          pnpm install --frozen-lockfile
          pnpm run build:electron
        env:
          CSC_LINK: ${{ secrets.CSC_LINK }}
          CSC_KEY_PASSWORD: ${{ secrets.CSC_KEY_PASSWORD }}
          APPLE_ID: ${{ secrets.APPLE_ID }}
          APPLE_ID_PASS: ${{ secrets.APPLE_ID_PASS }}
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist-${{ matrix.os }}
          path: dist/
      
      - name: Create release
        uses: softprops/action-gh-release@v1
        with:
          files: dist/*
          generate_release_notes: true
```

## ä¸šåŠ¡æµç¨‹ç¤ºä¾‹

### å…¸å‹ç”¨æˆ·æ•…äº‹çš„æŠ€æœ¯å®ç°æµç¨‹

ä¸ºäº†å¸®åŠ©å¼€å‘å›¢é˜Ÿæ›´å¥½åœ°ç†è§£ç³»ç»Ÿè¡Œä¸ºï¼Œä»¥ä¸‹æä¾›å‡ ä¸ªå…¸å‹ç”¨æˆ·æ•…äº‹çš„å®Œæ•´æŠ€æœ¯å®ç°æµç¨‹ï¼ŒåŒ…æ‹¬å‰ç«¯è°ƒç”¨åºåˆ—ã€IPC payload æ ·ä¾‹å’Œé¢„æœŸçš„æ•°æ®åº“å˜åŒ–ã€‚

#### ç”¨æˆ·æ•…äº‹ 1ï¼šåˆ›å»ºæ–°é¡¹ç›®å¹¶å¼€å§‹èŠå¤©

**ç”¨æˆ·æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"æŒ‰é’®
2. è¾“å…¥é¡¹ç›®åç§°"æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®"
3. ç¡®è®¤åˆ›å»º
4. ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºæ–°ä¼šè¯
5. ç”¨æˆ·å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯"ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"

**å‰ç«¯è°ƒç”¨åºåˆ—**ï¼š
```typescript
// 1. åˆ›å»ºé¡¹ç›®
const projectResponse = await ipcService.invoke('project:create', {
  name: 'æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®',
  description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®'
})

// 2. åˆ›å»ºä¼šè¯
const conversationResponse = await ipcService.invoke('conversation:create', {
  projectId: projectResponse.data.id,
  title: 'New Chat'
})

// 3. å‘é€æ¶ˆæ¯
const messageResponse = await ipcService.invoke('chat:send-message', {
  conversationId: conversationResponse.data.id,
  message: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±',
  ragEnabled: false,
  files: []
})
```

**IPC Payload æ ·ä¾‹**ï¼š
```typescript
// project:create è¯·æ±‚
{
  channel: 'project:create',
  version: 'v1.0.0',
  data: {
    name: 'æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®',
    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®'
  }
}

// project:create å“åº”
{
  success: true,
  data: {
    id: 1,
    name: 'æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®',
    created_at: '2024-01-15T10:30:00Z',
    updated_at: '2024-01-15T10:30:00Z'
  },
  version: 'v1.0.0'
}

// chat:send-message è¯·æ±‚
{
  channel: 'chat:send-message',
  version: 'v1.0.0',
  data: {
    conversationId: 1,
    message: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±',
    ragEnabled: false,
    files: []
  }
}
```

**é¢„æœŸæ•°æ®åº“å˜åŒ–**ï¼š
```sql
-- projects è¡¨æ–°å¢è®°å½•
INSERT INTO projects (id, name, created_at, updated_at) 
VALUES (1, 'æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®', '2024-01-15T10:30:00Z', '2024-01-15T10:30:00Z');

-- conversations è¡¨æ–°å¢è®°å½•
INSERT INTO conversations (id, title, project_id, created_at, updated_at)
VALUES (1, 'New Chat', 1, '2024-01-15T10:30:00Z', '2024-01-15T10:30:00Z');

-- messages è¡¨æ–°å¢ç”¨æˆ·æ¶ˆæ¯
INSERT INTO messages (id, conversation_id, role, content, created_at)
VALUES (1, 1, 'user', 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±', '2024-01-15T10:30:00Z');

-- messages è¡¨æ–°å¢AIå›å¤
INSERT INTO messages (id, conversation_id, role, content, created_at)
VALUES (2, 1, 'assistant', 'ä½ å¥½ï¼æˆ‘æ˜¯Knowlexæ™ºèƒ½åŠ©ç†...', '2024-01-15T10:30:05Z');
```

#### ç”¨æˆ·æ•…äº‹ 2ï¼šä¸Šä¼ æ–‡ä»¶å¹¶è¿›è¡ŒRAGæ£€ç´¢èŠå¤©

**ç”¨æˆ·æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·åœ¨ç°æœ‰é¡¹ç›®ä¸­ä¸Šä¼ PDFæ–‡ä»¶"æŠ€æœ¯æ–‡æ¡£.pdf"
2. ç³»ç»Ÿå¤„ç†æ–‡ä»¶å¹¶å‘é‡åŒ–
3. ç”¨æˆ·å¼€å¯RAGæ¨¡å¼
4. ç”¨æˆ·è¯¢é—®"æ–‡æ¡£ä¸­æåˆ°çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ"
5. ç³»ç»Ÿæ£€ç´¢ç›¸å…³å†…å®¹å¹¶å›ç­”

**å‰ç«¯è°ƒç”¨åºåˆ—**ï¼š
```typescript
// 1. ä¸Šä¼ æ–‡ä»¶
const fileResponse = await ipcService.invoke('file:upload', {
  projectId: 1,
  filePath: '/path/to/æŠ€æœ¯æ–‡æ¡£.pdf',
  filename: 'æŠ€æœ¯æ–‡æ¡£.pdf'
})

// 2. ç›‘å¬æ–‡ä»¶å¤„ç†è¿›åº¦
ipcService.on('file:processing-progress', (data) => {
  console.log(`Processing: ${data.progress}%`)
})

// 3. å‘é€RAGæŸ¥è¯¢
const ragResponse = await ipcService.invoke('chat:send-message', {
  conversationId: 1,
  message: 'æ–‡æ¡£ä¸­æåˆ°çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ',
  ragEnabled: true,
  files: []
})
```

**IPC Payload æ ·ä¾‹**ï¼š
```typescript
// file:upload è¯·æ±‚
{
  channel: 'file:upload',
  version: 'v1.0.0',
  data: {
    projectId: 1,
    filePath: '/path/to/æŠ€æœ¯æ–‡æ¡£.pdf',
    filename: 'æŠ€æœ¯æ–‡æ¡£.pdf'
  }
}

// file:processing-progress äº‹ä»¶
{
  channel: 'file:processing-progress',
  data: {
    fileId: 1,
    filename: 'æŠ€æœ¯æ–‡æ¡£.pdf',
    progress: 75,
    status: 'vectorizing',
    message: 'æ­£åœ¨å‘é‡åŒ–æ–‡æ¡£å†…å®¹...'
  }
}

// chat:send-message RAGæŸ¥è¯¢
{
  channel: 'chat:send-message',
  version: 'v1.0.0',
  data: {
    conversationId: 1,
    message: 'æ–‡æ¡£ä¸­æåˆ°çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ',
    ragEnabled: true,
    files: []
  }
}
```

**é¢„æœŸæ•°æ®åº“å˜åŒ–**ï¼š
```sql
-- files è¡¨æ–°å¢æ–‡ä»¶è®°å½•
INSERT INTO files (id, project_id, filename, original_path, pdf_path, file_size, md5_original, md5_pdf, status, created_at)
VALUES (1, 1, 'æŠ€æœ¯æ–‡æ¡£.pdf', '/data/files/1/original/æŠ€æœ¯æ–‡æ¡£.pdf', '/data/files/1/pdf/æŠ€æœ¯æ–‡æ¡£.pdf', 2048576, 'abc123...', 'def456...', 'completed', '2024-01-15T11:00:00Z');

-- vector_documents è¡¨æ–°å¢å‘é‡è®°å½•ï¼ˆå¤šæ¡ï¼‰
INSERT INTO vector_documents (id, file_id, project_id, chunk_index, content, filename, chunk_start, chunk_end, created_at, embedding)
VALUES 
('1_0', 1, 1, 0, 'æœ¬æ–‡æ¡£ä»‹ç»äº†Reactã€TypeScriptã€Electronç­‰æ ¸å¿ƒæŠ€æœ¯...', 'æŠ€æœ¯æ–‡æ¡£.pdf', 0, 500, '2024-01-15T11:05:00Z', '[0.1, 0.2, ...]'),
('1_1', 1, 1, 1, 'Reactæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“...', 'æŠ€æœ¯æ–‡æ¡£.pdf', 450, 950, '2024-01-15T11:05:00Z', '[0.3, 0.4, ...]');

-- messages è¡¨æ–°å¢RAGæŸ¥è¯¢å’Œå›å¤
INSERT INTO messages (id, conversation_id, role, content, file_references, created_at)
VALUES 
(3, 1, 'user', 'æ–‡æ¡£ä¸­æåˆ°çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ', NULL, '2024-01-15T11:10:00Z'),
(4, 1, 'assistant', 'æ ¹æ®æ‚¨ä¸Šä¼ çš„æŠ€æœ¯æ–‡æ¡£ï¼Œæ ¸å¿ƒæŠ€æœ¯åŒ…æ‹¬ï¼š\n1. React - ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢\n2. TypeScript - æä¾›ç±»å‹å®‰å…¨\n3. Electron - è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶', '["æŠ€æœ¯æ–‡æ¡£.pdf"]', '2024-01-15T11:10:05Z');
```

#### ç”¨æˆ·æ•…äº‹ 3ï¼šå…¨å±€æœç´¢å†å²å¯¹è¯

**ç”¨æˆ·æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·æŒ‰ä¸‹ Cmd+P æ‰“å¼€å…¨å±€æœç´¢
2. è¾“å…¥å…³é”®è¯"Reactç»„ä»¶"
3. ç³»ç»Ÿæ˜¾ç¤ºç›¸å…³çš„å†å²å¯¹è¯
4. ç”¨æˆ·ç‚¹å‡»æŸä¸ªæœç´¢ç»“æœ
5. ç³»ç»Ÿè·³è½¬åˆ°å¯¹åº”çš„ä¼šè¯

**å‰ç«¯è°ƒç”¨åºåˆ—**ï¼š
```typescript
// 1. æ‰§è¡Œå…¨å±€æœç´¢
const searchResponse = await ipcService.invoke('search:global', {
  query: 'Reactç»„ä»¶',
  limit: 10,
  offset: 0
})

// 2. è·³è½¬åˆ°æŒ‡å®šä¼šè¯
const conversationResponse = await ipcService.invoke('conversation:get', {
  id: searchResponse.data.results[0].conversationId
})
```

**IPC Payload æ ·ä¾‹**ï¼š
```typescript
// search:global è¯·æ±‚
{
  channel: 'search:global',
  version: 'v1.0.0',
  data: {
    query: 'Reactç»„ä»¶',
    limit: 10,
    offset: 0
  }
}

// search:global å“åº”
{
  success: true,
  data: {
    results: [
      {
        conversationId: 2,
        title: 'Reactå¼€å‘è®¨è®º',
        projectId: 1,
        projectName: 'æˆ‘çš„AIåŠ©æ‰‹é¡¹ç›®',
        snippet: '...å…³äº<mark>Reactç»„ä»¶</mark>çš„æœ€ä½³å®è·µï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘...',
        createdAt: '2024-01-14T15:20:00Z'
      }
    ],
    total: 1,
    hasMore: false
  },
  version: 'v1.0.0'
}
```

**é¢„æœŸæ•°æ®åº“æŸ¥è¯¢**ï¼š
```sql
-- å…¨æ–‡æœç´¢æŸ¥è¯¢ï¼ˆä½¿ç”¨FTS5ï¼‰
SELECT 
  c.id as conversation_id,
  c.title,
  c.project_id,
  p.name as project_name,
  m.content,
  m.created_at,
  snippet(messages_fts, 2, '<mark>', '</mark>', '...', 32) as snippet
FROM messages_fts
JOIN messages m ON messages_fts.rowid = m.id
JOIN conversations c ON m.conversation_id = c.id
LEFT JOIN projects p ON c.project_id = p.id
WHERE messages_fts MATCH 'Reactç»„ä»¶'
ORDER BY c.updated_at DESC
LIMIT 10 OFFSET 0;
```

#### ç”¨æˆ·æ•…äº‹ 4ï¼šç®¡ç†é¡¹ç›®è®°å¿†å’ŒçŸ¥è¯†

**ç”¨æˆ·æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ è®°å¿†"è¿™ä¸ªé¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ AIæŠ€æœ¯"
2. ç”¨æˆ·ä»èŠå¤©ä¸­é€‰æ‹©ä¸€æ®µæ–‡å­—ä¿å­˜ä¸ºçŸ¥è¯†
3. ç”¨æˆ·ç¼–è¾‘çŸ¥è¯†å†…å®¹å¹¶ä¿å­˜

**å‰ç«¯è°ƒç”¨åºåˆ—**ï¼š
```typescript
// 1. æ·»åŠ é¡¹ç›®è®°å¿†
const memoryResponse = await ipcService.invoke('project:add-memory', {
  projectId: 1,
  content: 'è¿™ä¸ªé¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ AIæŠ€æœ¯',
  type: 'memory'
})

// 2. ä¿å­˜èŠå¤©å†…å®¹ä¸ºçŸ¥è¯†
const knowledgeResponse = await ipcService.invoke('project:add-knowledge', {
  projectId: 1,
  title: 'Reactç»„ä»¶æœ€ä½³å®è·µ',
  content: 'ä»èŠå¤©ä¸­é€‰æ‹©çš„å†…å®¹ï¼šReactç»„ä»¶åº”è¯¥ä¿æŒå•ä¸€èŒè´£...'
})

// 3. æ›´æ–°çŸ¥è¯†å†…å®¹
const updateResponse = await ipcService.invoke('project:update-knowledge', {
  id: knowledgeResponse.data.id,
  title: 'Reactç»„ä»¶å¼€å‘æŒ‡å—',
  content: 'æ›´æ–°åçš„å†…å®¹ï¼šReactç»„ä»¶å¼€å‘çš„å®Œæ•´æŒ‡å—...'
})
```

**é¢„æœŸæ•°æ®åº“å˜åŒ–**ï¼š
```sql
-- project_memories è¡¨æ–°å¢è®°å¿†
INSERT INTO project_memories (id, project_id, content, type, is_system, created_at)
VALUES (1, 1, 'è¿™ä¸ªé¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ AIæŠ€æœ¯', 'memory', FALSE, '2024-01-15T12:00:00Z');

-- project_knowledge è¡¨æ–°å¢çŸ¥è¯†
INSERT INTO project_knowledge (id, project_id, title, content, created_at, updated_at)
VALUES (1, 1, 'Reactç»„ä»¶æœ€ä½³å®è·µ', 'ä»èŠå¤©ä¸­é€‰æ‹©çš„å†…å®¹ï¼šReactç»„ä»¶åº”è¯¥ä¿æŒå•ä¸€èŒè´£...', '2024-01-15T12:05:00Z', '2024-01-15T12:05:00Z');

-- æ›´æ–°çŸ¥è¯†å†…å®¹
UPDATE project_knowledge 
SET title = 'Reactç»„ä»¶å¼€å‘æŒ‡å—', 
    content = 'æ›´æ–°åçš„å†…å®¹ï¼šReactç»„ä»¶å¼€å‘çš„å®Œæ•´æŒ‡å—...', 
    updated_at = '2024-01-15T12:10:00Z'
WHERE id = 1;
```

### é”™è¯¯å¤„ç†æµç¨‹ç¤ºä¾‹

#### æ–‡ä»¶ä¸Šä¼ å¤±è´¥çš„å¤„ç†æµç¨‹

**åœºæ™¯**ï¼šç”¨æˆ·ä¸Šä¼ è¶…å¤§æ–‡ä»¶å¯¼è‡´å¤„ç†å¤±è´¥

**å‰ç«¯è°ƒç”¨åºåˆ—**ï¼š
```typescript
try {
  const fileResponse = await ipcService.invoke('file:upload', {
    projectId: 1,
    filePath: '/path/to/huge-file.pdf',
    filename: 'huge-file.pdf'
  })
} catch (error) {
  // å¤„ç†é”™è¯¯
  console.error('File upload failed:', error)
  showErrorNotification(error.message)
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**ï¼š
```typescript
{
  success: false,
  error: {
    code: 'FILE_TOO_LARGE',
    message: 'æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆæœ€å¤§1MBï¼‰',
    details: {
      fileSize: 5242880,
      maxSize: 1048576,
      filename: 'huge-file.pdf'
    }
  },
  version: 'v1.0.0'
}
```

è¿™äº›ä¸šåŠ¡æµç¨‹ç¤ºä¾‹ä¸ºå¼€å‘å›¢é˜Ÿæä¾›äº†æ¸…æ™°çš„æŠ€æœ¯å®ç°è·¯å¾„ï¼Œç¡®ä¿å‰åç«¯å¼€å‘äººå‘˜èƒ½å¤Ÿå‡†ç¡®ç†è§£ç³»ç»Ÿçš„é¢„æœŸè¡Œä¸ºå’Œæ•°æ®æµè½¬è¿‡ç¨‹ã€‚

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. OpenAI Agents JS é›†æˆ

```typescript
// src/services/api/openai.service.ts
import { Agent, run, tool } from '@openai/agents'
import { setDefaultOpenAIClient } from '@openai/agents'
import OpenAI from 'openai'

export class OpenAIService {
  private client: OpenAI
  private agent: Agent

  constructor(apiKey: string, baseURL: string, model: string) {
    this.client = new OpenAI({
      apiKey,
      baseURL,
    })

    setDefaultOpenAIClient(this.client)

    this.agent = new Agent({
      name: 'Knowlex Assistant',
      instructions: 'You are a helpful desktop assistant.',
      model,
    })
  }

  async sendMessage(
    message: string,
    context?: string,
    systemPrompt?: string,
    stream: boolean = true
  ) {
    const instructions = systemPrompt || this.agent.instructions
    const fullMessage = context ? `${context}\n\n${message}` : message

    if (stream) {
      const streamResult = await run(this.agent, fullMessage, {
        stream: true,
        instructions,
      })

      return streamResult
    } else {
      const result = await run(this.agent, fullMessage, { instructions })
      return result
    }
  }

  async generateTitle(conversation: string): Promise<string> {
    const titleAgent = new Agent({
      name: 'Title Generator',
      instructions: 'Generate a concise title (max 10 words) for the conversation.',
    })

    const result = await run(titleAgent, `Generate a title for this conversation: ${conversation}`)

    return result.finalOutput || 'Untitled Chat'
  }

  async generateSummary(conversation: string): Promise<string> {
    const summaryAgent = new Agent({
      name: 'Summary Generator',
      instructions: 'Create a concise summary of the conversation (max 1000 tokens).',
    })

    const result = await run(summaryAgent, `Summarize this conversation: ${conversation}`)

    return result.finalOutput || ''
  }
}
```

### 2. å‘é‡åŒ–ä¸ RAG å®ç°

```typescript
// src/services/api/embedding.service.ts
export class EmbeddingService {
  private client: OpenAI

  constructor(apiKey: string, baseURL: string, model: string) {
    this.client = new OpenAI({
      apiKey,
      baseURL,
    })
  }

  async embedText(text: string): Promise<number[]> {
    const response = await this.client.embeddings.create({
      model: 'text-embedding-3-small', // æˆ–é…ç½®çš„æ¨¡å‹
      input: text,
    })

    return response.data[0].embedding
  }

  async embedTexts(texts: string[]): Promise<number[][]> {
    const response = await this.client.embeddings.create({
      model: 'text-embedding-3-small',
      input: texts,
    })

    return response.data.map(item => item.embedding)
  }
}

// src-electron/services/ai/rag.service.ts
export class RAGService {
  constructor(
    private vectorManager: VectorManager,
    private embeddingService: EmbeddingService,
    private rerankService?: RerankService
  ) {}

  async retrieveRelevantContext(
    query: string,
    projectId: number,
    topK: number = 20, // å¢åŠ åˆå§‹å¬å›æ•°é‡
    finalK: number = 5
  ): Promise<{ context: string; sources: string[] }> {
    // 1. å‘é‡åŒ–æŸ¥è¯¢
    const queryVector = await this.embeddingService.embedText(query)

    // 2. åœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢ï¼ˆæ‰©å¤§å¬å›èŒƒå›´ï¼‰
    const vectorResults = await this.vectorManager.search(queryVector, projectId, topK)

    // 3. é˜ˆå€¼è¿‡æ»¤ï¼ˆscore > 0.2ï¼‰
    const filteredResults = vectorResults.filter(result => result.score > 0.2)

    // 4. é‡æ’ä¼˜åŒ–ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    let finalResults = filteredResults
    if (this.rerankService && (await this.rerankService.isEnabled())) {
      finalResults = await this.rerankService.rerank(query, filteredResults, finalK)
    } else {
      // ä½¿ç”¨ MMR (Max Marginal Relevance) æå‡å¤šæ ·æ€§
      finalResults = this.applyMMR(filteredResults, finalK, 0.7)
    }

    // 5. æ„å»ºä¸Šä¸‹æ–‡å’Œæ¥æº
    const context = finalResults
      .map(result => `[${result.filename}]\n${result.content}`)
      .join('\n\n---\n\n')

    const sources = [...new Set(finalResults.map(result => result.filename))]

    return { context, sources }
  }

  private applyMMR(results: VectorDocument[], k: number, lambda: number = 0.7): VectorDocument[] {
    if (results.length <= k) return results

    const selected: VectorDocument[] = []
    const remaining = [...results]

    // é€‰æ‹©ç¬¬ä¸€ä¸ªæœ€ç›¸å…³çš„
    selected.push(remaining.shift()!)

    while (selected.length < k && remaining.length > 0) {
      let bestIndex = 0
      let bestScore = -Infinity

      for (let i = 0; i < remaining.length; i++) {
        const candidate = remaining[i]

        // è®¡ç®—ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§ï¼ˆå·²æœ‰çš„å‘é‡ç›¸ä¼¼åº¦ï¼‰
        const relevanceScore = candidate.score || 0

        // è®¡ç®—ä¸å·²é€‰æ‹©æ–‡æ¡£çš„æœ€å¤§ç›¸ä¼¼åº¦ï¼ˆå¤šæ ·æ€§æƒ©ç½šï¼‰
        const maxSimilarity = Math.max(
          ...selected.map(doc => this.calculateTextSimilarity(candidate.content, doc.content))
        )

        // MMR åˆ†æ•°ï¼šå¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§
        const mmrScore = lambda * relevanceScore - (1 - lambda) * maxSimilarity

        if (mmrScore > bestScore) {
          bestScore = mmrScore
          bestIndex = i
        }
      }

      selected.push(remaining.splice(bestIndex, 1)[0])
    }

    return selected
  }

  private calculateTextSimilarity(text1: string, text2: string): number {
    // ç®€å•çš„æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆå¯ä»¥ç”¨æ›´å¤æ‚çš„ç®—æ³•æ›¿æ¢ï¼‰
    const words1 = new Set(text1.toLowerCase().split(/\s+/))
    const words2 = new Set(text2.toLowerCase().split(/\s+/))

    const intersection = new Set([...words1].filter(x => words2.has(x)))
    const union = new Set([...words1, ...words2])

    return intersection.size / union.size
  }

  async processFileForRAG(
    fileId: number,
    projectId: number,
    content: string,
    filename: string
  ): Promise<void> {
    // 1. æ™ºèƒ½æ–‡æœ¬åˆ†å—ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰
    const chunks = await this.smartChunkText(content, 500, 50)

    // 2. æ‰¹é‡å‘é‡åŒ–
    const vectors = await this.embeddingService.embedTexts(chunks.map(c => c.text))

    // 3. å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“
    const documents: VectorDocument[] = chunks.map((chunk, index) => ({
      id: `${fileId}_${index}`,
      file_id: fileId,
      project_id: projectId,
      chunk_index: index,
      content: chunk.text,
      filename,
      chunk_start: chunk.start,
      chunk_end: chunk.end,
      created_at: new Date().toISOString(),
      embedding: vectors[index],
    }))

    await this.vectorManager.insertDocuments(documents)
  }

  private async smartChunkText(
    text: string,
    maxTokens: number,
    overlapTokens: number
  ): Promise<Array<{ text: string; start: number; end: number }>> {
    const chunks: Array<{ text: string; start: number; end: number }> = []

    // æŒ‰æ®µè½åˆ†å‰²ï¼Œä¼˜å…ˆä¿æŒè¯­ä¹‰å®Œæ•´æ€§
    const paragraphs = text.split(/\n\s*\n/)
    let currentChunk = ''
    let currentStart = 0
    let currentPos = 0

    for (const paragraph of paragraphs) {
      const paragraphTokens = this.estimateTokens(paragraph)
      const currentTokens = this.estimateTokens(currentChunk)

      if (currentTokens + paragraphTokens <= maxTokens) {
        // å½“å‰æ®µè½å¯ä»¥åŠ å…¥å½“å‰å—
        currentChunk += (currentChunk ? '\n\n' : '') + paragraph
      } else {
        // å½“å‰å—å·²æ»¡ï¼Œä¿å­˜å¹¶å¼€å§‹æ–°å—
        if (currentChunk) {
          chunks.push({
            text: currentChunk,
            start: currentStart,
            end: currentPos + currentChunk.length,
          })

          // å¤„ç†é‡å 
          const overlapText = this.getOverlapText(currentChunk, overlapTokens)
          currentChunk = overlapText + (overlapText ? '\n\n' : '') + paragraph
          currentStart = currentPos + currentChunk.length - overlapText.length
        } else {
          currentChunk = paragraph
        }
      }

      currentPos += paragraph.length + 2 // +2 for \n\n
    }

    // æ·»åŠ æœ€åä¸€ä¸ªå—
    if (currentChunk) {
      chunks.push({
        text: currentChunk,
        start: currentStart,
        end: currentPos,
      })
    }

    return chunks
  }

  private estimateTokens(text: string): number {
    // ç®€å•çš„ token ä¼°ç®—ï¼šä¸­æ–‡å­—ç¬¦æŒ‰1ä¸ªtokenï¼Œè‹±æ–‡å•è¯æŒ‰0.75ä¸ªtoken
    const chineseChars = (text.match(/[\u4e00-\u9fff]/g) || []).length
    const englishWords = (text.match(/[a-zA-Z]+/g) || []).length
    return Math.ceil(chineseChars + englishWords * 0.75)
  }

  private getOverlapText(text: string, overlapTokens: number): string {
    const sentences = text.split(/[.!?ã€‚ï¼ï¼Ÿ]/)
    let overlapText = ''
    let tokenCount = 0

    // ä»æœ«å°¾å¼€å§‹ï¼Œé€‰æ‹©å®Œæ•´çš„å¥å­ä½œä¸ºé‡å 
    for (let i = sentences.length - 1; i >= 0; i--) {
      const sentence = sentences[i].trim()
      const sentenceTokens = this.estimateTokens(sentence)

      if (tokenCount + sentenceTokens <= overlapTokens) {
        overlapText = sentence + (overlapText ? '. ' : '') + overlapText
        tokenCount += sentenceTokens
      } else {
        break
      }
    }

    return overlapText
  }
}

// src-electron/services/ai/rerank.client.ts
export class RerankService {
  private client: OpenAI
  private modelName: string
  private enabled: boolean = false

  constructor() {
    this.loadSettings()
  }

  async isEnabled(): Promise<boolean> {
    return this.enabled
  }

  async rerank(
    query: string,
    documents: VectorDocument[],
    topK: number
  ): Promise<VectorDocument[]> {
    if (!this.enabled || !this.client) {
      return documents.slice(0, topK)
    }

    try {
      // æ„å»ºé‡æ’è¯·æ±‚
      const rerankTexts = documents.map(doc => doc.content)

      // è°ƒç”¨é‡æ’æ¨¡å‹ APIï¼ˆå‡è®¾ä½¿ç”¨å…¼å®¹çš„é‡æ’æ¥å£ï¼‰
      const response = await this.client.chat.completions.create({
        model: this.modelName,
        messages: [
          {
            role: 'system',
            content: `You are a document reranker. Given a query and a list of documents, return the relevance scores (0-1) for each document. Return only a JSON array of scores.`,
          },
          {
            role: 'user',
            content: `Query: ${query}\n\nDocuments:\n${rerankTexts.map((text, i) => `${i}: ${text}`).join('\n\n')}`,
          },
        ],
        temperature: 0,
      })

      const scoresText = response.choices[0]?.message?.content || '[]'
      const scores = JSON.parse(scoresText) as number[]

      // ç»“åˆåŸå§‹åˆ†æ•°å’Œé‡æ’åˆ†æ•°
      const rankedDocs = documents
        .map((doc, index) => ({
          ...doc,
          relevance_score: scores[index] || 0,
        }))
        .sort((a, b) => b.relevance_score - a.relevance_score)
        .slice(0, topK)

      return rankedDocs
    } catch (error) {
      console.warn('Rerank failed, falling back to original ranking:', error)
      return documents.slice(0, topK)
    }
  }

  private async loadSettings(): Promise<void> {
    // ä»æ•°æ®åº“åŠ è½½é‡æ’è®¾ç½®
    // å®ç°çœç•¥...
  }
}

// src-electron/services/database/vector.manager.ts (hnswsqlite)
export class VectorManager {
  private db: Database

  constructor(dbPath: string) {
    this.db = new Database(dbPath)
    this.initializeVectorDB()
  }

  private initializeVectorDB(): void {
    // å¯ç”¨ hnswsqlite æ‰©å±•
    this.db.loadExtension('hnswsqlite')

    // åˆ›å»ºå‘é‡è¡¨
    this.db.exec(`
      CREATE VIRTUAL TABLE IF NOT EXISTS vector_documents USING hnsw(
        id TEXT PRIMARY KEY,
        file_id INTEGER,
        project_id INTEGER,
        chunk_index INTEGER,
        content TEXT,
        filename TEXT,
        chunk_start INTEGER,
        chunk_end INTEGER,
        created_at TEXT,
        embedding(768) -- æ ¹æ®å®é™…æ¨¡å‹è°ƒæ•´ç»´åº¦
      );
      
      CREATE INDEX IF NOT EXISTS idx_vector_project_id ON vector_documents(project_id);
      CREATE INDEX IF NOT EXISTS idx_vector_file_id ON vector_documents(file_id);
    `)
  }

  async insertDocuments(documents: VectorDocument[]): Promise<void> {
    const stmt = this.db.prepare(`
      INSERT INTO vector_documents (
        id, file_id, project_id, chunk_index, content, 
        filename, chunk_start, chunk_end, created_at, embedding
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `)

    const transaction = this.db.transaction((docs: VectorDocument[]) => {
      for (const doc of docs) {
        stmt.run(
          doc.id,
          doc.file_id,
          doc.project_id,
          doc.chunk_index,
          doc.content,
          doc.filename,
          doc.chunk_start,
          doc.chunk_end,
          doc.created_at,
          JSON.stringify(doc.embedding) // hnswsqlite å¤„ç†å‘é‡æ ¼å¼
        )
      }
    })

    transaction(documents)
  }

  async search(queryVector: number[], projectId: number, topK: number): Promise<VectorDocument[]> {
    const stmt = this.db.prepare(`
      SELECT 
        id, file_id, project_id, chunk_index, content,
        filename, chunk_start, chunk_end, created_at,
        distance(embedding, ?) as score
      FROM vector_documents
      WHERE project_id = ?
      ORDER BY score ASC
      LIMIT ?
    `)

    const results = stmt.all(JSON.stringify(queryVector), projectId, topK)

    return results.map(row => ({
      id: row.id,
      file_id: row.file_id,
      project_id: row.project_id,
      chunk_index: row.chunk_index,
      content: row.content,
      filename: row.filename,
      chunk_start: row.chunk_start,
      chunk_end: row.chunk_end,
      created_at: row.created_at,
      embedding: [], // ä¸è¿”å›å‘é‡æ•°æ®ä»¥èŠ‚çœå†…å­˜
      score: 1 - row.score, // è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•°
    }))
  }

  async deleteByFileId(fileId: number): Promise<void> {
    const stmt = this.db.prepare('DELETE FROM vector_documents WHERE file_id = ?')
    stmt.run(fileId)

    // æ‰§è¡Œ VACUUM å›æ”¶ç©ºé—´
    this.db.exec('VACUUM')
  }

  async deleteByProjectId(projectId: number): Promise<void> {
    const stmt = this.db.prepare('DELETE FROM vector_documents WHERE project_id = ?')
    stmt.run(projectId)

    this.db.exec('VACUUM')
  }
}
```

### 3. æ–‡ä»¶å¤„ç†ä¸è½¬æ¢

```typescript
// src-electron/services/file/file.manager.ts
import * as fs from 'fs/promises'
import * as path from 'path'
import * as crypto from 'crypto'
import { PDFConverter } from './pdf.converter'

export class FileManager {
  constructor(
    private dataDir: string,
    private pdfConverter: PDFConverter
  ) {}

  async processUploadedFile(
    filePath: string,
    projectId: number,
    filename: string
  ): Promise<{
    fileId: number
    originalPath: string
    pdfPath: string
    md5Original: string
    md5Pdf: string
  }> {
    // 1. è¯»å–åŸå§‹æ–‡ä»¶
    const originalContent = await fs.readFile(filePath)
    const md5Original = crypto.createHash('md5').update(originalContent).digest('hex')

    // 2. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ–‡ä»¶
    const existingFile = await this.checkDuplicateFile(md5Original)
    if (existingFile) {
      return existingFile
    }

    // 3. ä¿å­˜åŸå§‹æ–‡ä»¶
    const originalPath = path.join(
      this.dataDir,
      'files',
      `${projectId}`,
      'original',
      `${Date.now()}_${filename}`
    )
    await fs.mkdir(path.dirname(originalPath), { recursive: true })
    await fs.copyFile(filePath, originalPath)

    // 4. è½¬æ¢ä¸º PDF/A
    const pdfPath = path.join(
      this.dataDir,
      'files',
      `${projectId}`,
      'pdf',
      `${Date.now()}_${filename}.pdf`
    )
    await fs.mkdir(path.dirname(pdfPath), { recursive: true })

    try {
      await this.pdfConverter.convertToPDFA(originalPath, pdfPath)
      const pdfContent = await fs.readFile(pdfPath)
      const md5Pdf = crypto.createHash('md5').update(pdfContent).digest('hex')

      // 5. ä¿å­˜åˆ°æ•°æ®åº“
      const fileId = await this.saveFileMetadata({
        projectId,
        filename,
        originalPath,
        pdfPath,
        fileSize: originalContent.length,
        md5Original,
        md5Pdf,
        status: 'completed',
      })

      return {
        fileId,
        originalPath,
        pdfPath,
        md5Original,
        md5Pdf,
      }
    } catch (error) {
      // PDF è½¬æ¢å¤±è´¥ï¼Œæ ‡è®°çŠ¶æ€
      const fileId = await this.saveFileMetadata({
        projectId,
        filename,
        originalPath,
        pdfPath: '',
        fileSize: originalContent.length,
        md5Original,
        md5Pdf: '',
        status: 'failed',
      })

      throw new Error(`PDF conversion failed: ${error.message}`)
    }
  }

  private async checkDuplicateFile(md5: string): Promise<any> {
    // æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒ MD5 çš„æ–‡ä»¶
    // å®ç°çœç•¥...
  }

  private async saveFileMetadata(metadata: any): Promise<number> {
    // ä¿å­˜æ–‡ä»¶å…ƒæ•°æ®åˆ° SQLite
    // å®ç°çœç•¥...
  }
}
```

### 4. å…¨æ–‡æœç´¢å®ç°

```typescript
// src-electron/services/search/fulltext.service.ts
export class FullTextSearchService {
  constructor(private dbManager: SQLiteManager) {}

  async searchConversations(
    query: string,
    limit: number = 10,
    offset: number = 0
  ): Promise<SearchResult[]> {
    const sql = `
      SELECT 
        c.id as conversation_id,
        c.title,
        c.project_id,
        p.name as project_name,
        m.content,
        m.created_at,
        snippet(messages_fts, 2, '<mark>', '</mark>', '...', 32) as snippet
      FROM messages_fts
      JOIN messages m ON messages_fts.rowid = m.id
      JOIN conversations c ON m.conversation_id = c.id
      LEFT JOIN projects p ON c.project_id = p.id
      WHERE messages_fts MATCH ?
      ORDER BY c.updated_at DESC
      LIMIT ? OFFSET ?
    `

    const results = await this.dbManager.query(sql, [query, limit, offset])

    return results.map(row => ({
      conversationId: row.conversation_id,
      title: row.title,
      projectId: row.project_id,
      projectName: row.project_name || 'Uncategorized',
      snippet: row.snippet,
      createdAt: row.created_at,
    }))
  }

  async initializeFTS(): Promise<void> {
    // è®¾ç½® SQLite é…ç½®ä»¥ä¼˜åŒ–ä¸­è‹±æ–‡æœç´¢
    await this.dbManager.exec(`
      PRAGMA page_size = 8192;
      PRAGMA journal_mode = WAL;
    `)

    // åˆ›å»ºå…¨æ–‡æœç´¢è™šæ‹Ÿè¡¨ï¼Œæ”¯æŒä¸­è‹±æ–‡åˆ†è¯
    const sql = `
      CREATE VIRTUAL TABLE IF NOT EXISTS messages_fts 
      USING fts5(
        content, 
        content='messages', 
        content_rowid='id',
        tokenize='unicode61 remove_diacritics 2'
      );
      
      -- åˆ›å»ºè§¦å‘å™¨ä¿æŒ FTS è¡¨åŒæ­¥
      CREATE TRIGGER IF NOT EXISTS messages_ai AFTER INSERT ON messages BEGIN
        INSERT INTO messages_fts(rowid, content) VALUES (new.id, new.content);
      END;
      
      CREATE TRIGGER IF NOT EXISTS messages_ad AFTER DELETE ON messages BEGIN
        INSERT INTO messages_fts(messages_fts, rowid, content) VALUES('delete', old.id, old.content);
      END;
      
      CREATE TRIGGER IF NOT EXISTS messages_au AFTER UPDATE ON messages BEGIN
        INSERT INTO messages_fts(messages_fts, rowid, content) VALUES('delete', old.id, old.content);
        INSERT INTO messages_fts(rowid, content) VALUES (new.id, new.content);
      END;
    `

    await this.dbManager.exec(sql)

    // å®šæœŸä¼˜åŒ– FTS ç´¢å¼•
    setInterval(
      async () => {
        try {
          await this.dbManager.exec("INSERT INTO messages_fts(messages_fts) VALUES('optimize')")
        } catch (error) {
          console.warn('FTS optimization failed:', error)
        }
      },
      24 * 60 * 60 * 1000
    ) // æ¯24å°æ—¶ä¼˜åŒ–ä¸€æ¬¡
  }
}
```

## çŠ¶æ€ç®¡ç†è®¾è®¡

### Zustand Store ç»“æ„

```typescript
// src/stores/app.store.ts
interface AppState {
  // UI çŠ¶æ€
  sidebarWidth: number
  currentView: 'chat' | 'project' | 'settings'
  theme: 'light' | 'dark' | 'system'

  // åŠ è½½çŠ¶æ€
  isLoading: boolean
  loadingMessage: string

  // é”™è¯¯çŠ¶æ€
  error: string | null

  // æ“ä½œ
  setSidebarWidth: (width: number) => void
  setCurrentView: (view: string) => void
  setTheme: (theme: string) => void
  setLoading: (loading: boolean, message?: string) => void
  setError: (error: string | null) => void
}

// src/stores/chat.store.ts
interface ChatState {
  // å½“å‰ä¼šè¯
  currentConversation: Conversation | null
  messages: Message[]

  // è¾“å…¥çŠ¶æ€
  inputText: string
  uploadedFiles: File[]
  isStreaming: boolean

  // RAG çŠ¶æ€
  ragEnabled: boolean
  ragContext: string[]

  // æ“ä½œ
  setCurrentConversation: (conversation: Conversation | null) => void
  addMessage: (message: Message) => void
  updateMessage: (id: string, updates: Partial<Message>) => void
  setInputText: (text: string) => void
  addUploadedFile: (file: File) => void
  removeUploadedFile: (index: number) => void
  setStreaming: (streaming: boolean) => void
  toggleRAG: () => void
  setRAGContext: (context: string[]) => void
}

// src/stores/project.store.ts
interface ProjectState {
  // é¡¹ç›®æ•°æ®
  projects: Project[]
  currentProject: Project | null

  // æ–‡ä»¶æ•°æ®
  projectFiles: ProjectFile[]
  fileUploadProgress: Record<string, number>

  // è®°å¿†ä¸çŸ¥è¯†
  projectMemories: ProjectMemory[]
  projectKnowledge: ProjectKnowledge[]

  // æ“ä½œ
  setProjects: (projects: Project[]) => void
  setCurrentProject: (project: Project | null) => void
  addProject: (project: Project) => void
  updateProject: (id: number, updates: Partial<Project>) => void
  deleteProject: (id: number) => void

  setProjectFiles: (files: ProjectFile[]) => void
  addProjectFile: (file: ProjectFile) => void
  updateFileProgress: (fileId: string, progress: number) => void

  setProjectMemories: (memories: ProjectMemory[]) => void
  addProjectMemory: (memory: ProjectMemory) => void
  updateProjectMemory: (id: number, updates: Partial<ProjectMemory>) => void
  deleteProjectMemory: (id: number) => void

  setProjectKnowledge: (knowledge: ProjectKnowledge[]) => void
  addProjectKnowledge: (knowledge: ProjectKnowledge) => void
  updateProjectKnowledge: (id: number, updates: Partial<ProjectKnowledge>) => void
  deleteProjectKnowledge: (id: number) => void
}
```

## IPC é€šä¿¡è®¾è®¡

### IPC é€šé“å®šä¹‰

```typescript
// src/types/ipc.types.ts
export interface IPCChannels {
  // èŠå¤©ç›¸å…³
  'chat:send-message': {
    request: {
      message: string
      conversationId?: number
      projectId?: number
      files?: string[]
      ragEnabled?: boolean
    }
    response: {
      messageId: string
      stream?: AsyncIterable<string>
    }
  }

  'chat:generate-title': {
    request: { conversationId: number }
    response: { title: string }
  }

  // é¡¹ç›®ç›¸å…³
  'project:create': {
    request: { name: string; description?: string }
    response: { project: Project }
  }

  'project:list': {
    request: {}
    response: { projects: Project[] }
  }

  'project:delete': {
    request: { projectId: number }
    response: { success: boolean }
  }

  // æ–‡ä»¶ç›¸å…³
  'file:upload': {
    request: {
      filePaths: string[]
      projectId: number
    }
    response: {
      files: ProjectFile[]
      progress?: Record<string, number>
    }
  }

  'file:delete': {
    request: { fileId: number }
    response: { success: boolean }
  }

  // æœç´¢ç›¸å…³
  'search:global': {
    request: {
      query: string
      limit?: number
      offset?: number
    }
    response: { results: SearchResult[] }
  }

  // è®¾ç½®ç›¸å…³
  'settings:get': {
    request: { key?: string }
    response: { settings: Record<string, any> }
  }

  'settings:set': {
    request: { key: string; value: any }
    response: { success: boolean }
  }

  'settings:test-api': {
    request: {
      type: 'chat' | 'embedding' | 'rerank'
      config: APIConfig
    }
    response: {
      success: boolean
      error?: string
    }
  }

  'settings:rerank-config': {
    request: {
      modelName: string
      apiKey?: string
      baseUrl?: string
      enabled: boolean
    }
    response: { success: boolean }
  }
}
```

## é”™è¯¯å¤„ç†ä¸æ—¥å¿—

### é”™è¯¯å¤„ç†ç­–ç•¥

```typescript
// src/utils/error-handler.ts
export class ErrorHandler {
  static handleAPIError(error: any): string {
    if (error.code === 'ENOTFOUND') {
      return 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®'
    }

    if (error.status === 401) {
      return 'API å¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥é…ç½®'
    }

    if (error.status === 429) {
      return 'API è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åé‡è¯•'
    }

    if (error.status === 500) {
      return 'API æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
    }

    return error.message || 'æœªçŸ¥é”™è¯¯'
  }

  static handleFileError(error: any): string {
    if (error.code === 'ENOENT') {
      return 'æ–‡ä»¶ä¸å­˜åœ¨'
    }

    if (error.code === 'EACCES') {
      return 'æ–‡ä»¶è®¿é—®æƒé™ä¸è¶³'
    }

    if (error.code === 'EMFILE') {
      return 'æ‰“å¼€æ–‡ä»¶æ•°é‡è¿‡å¤š'
    }

    return error.message || 'æ–‡ä»¶æ“ä½œå¤±è´¥'
  }
}

// src-electron/utils/logger.ts
import * as winston from 'winston'
import * as path from 'path'
import { app } from 'electron'

export const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({
      filename: path.join(app.getPath('userData'), 'logs', 'error.log'),
      level: 'error',
      maxsize: 10 * 1024 * 1024, // 10MB
      maxFiles: 5,
      tailable: true,
    }),
    new winston.transports.File({
      filename: path.join(app.getPath('userData'), 'logs', 'combined.log'),
      maxsize: 10 * 1024 * 1024, // 10MB
      maxFiles: 30, // ä¿ç•™30å¤©
      tailable: true,
    }),
  ],
})

if (process.env.NODE_ENV !== 'production') {
  logger.add(
    new winston.transports.Console({
      format: winston.format.simple(),
    })
  )
}

// å®šæœŸæ¸…ç†æ—§æ—¥å¿—
setInterval(
  () => {
    // Winston çš„ maxFiles ä¼šè‡ªåŠ¨å¤„ç†æ—¥å¿—è½®è½¬
  },
  24 * 60 * 60 * 1000
)
```

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å‰ç«¯ä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**: é•¿æ¶ˆæ¯åˆ—è¡¨å’Œæœç´¢ç»“æœä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **æ‡’åŠ è½½**: ç»„ä»¶å’Œè·¯ç”±æ‡’åŠ è½½
- **é˜²æŠ–èŠ‚æµ**: æœç´¢è¾“å…¥å’Œ API è°ƒç”¨é˜²æŠ–
- **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨ React Query ç¼“å­˜ API å“åº”

### 2. åç«¯ä¼˜åŒ–

- **æ•°æ®åº“è¿æ¥æ± **: SQLite è¿æ¥å¤ç”¨
- **æ‰¹é‡æ“ä½œ**: å‘é‡åŒ–å’Œæ•°æ®åº“å†™å…¥æ‰¹é‡å¤„ç†
- **å¼‚æ­¥å¤„ç†**: æ–‡ä»¶å¤„ç†å’Œå‘é‡åŒ–å¼‚æ­¥æ‰§è¡Œ
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾å¤§æ–‡ä»¶å†…å­˜

### 3. å­˜å‚¨ä¼˜åŒ–

- **ç´¢å¼•ä¼˜åŒ–**: å…³é”®æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- **æ•°æ®å‹ç¼©**: å‘é‡æ•°æ®å‹ç¼©å­˜å‚¨
- **æ¸…ç†ç­–ç•¥**: å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œè¿‡æœŸæ•°æ®

## å®‰å…¨è€ƒè™‘

### 1. æ•°æ®å®‰å…¨

- **æœ¬åœ°å­˜å‚¨**: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¸Šä¼ åˆ°äº‘ç«¯
- **API å¯†é’¥**: åŠ å¯†å­˜å‚¨ API å¯†é’¥
- **æ–‡ä»¶æƒé™**: é™åˆ¶æ–‡ä»¶è®¿é—®æƒé™

### 2. è¾“å…¥éªŒè¯

- **æ–‡ä»¶ç±»å‹**: ä¸¥æ ¼éªŒè¯ä¸Šä¼ æ–‡ä»¶ç±»å‹
- **æ–‡ä»¶å¤§å°**: é™åˆ¶å•æ–‡ä»¶å’Œæ€»æ–‡ä»¶å¤§å°
- **SQL æ³¨å…¥**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥

### 3. è¿›ç¨‹éš”ç¦»

- **æ²™ç®±**: Renderer è¿›ç¨‹è¿è¡Œåœ¨æ²™ç®±ç¯å¢ƒ
- **æƒé™æ§åˆ¶**: æœ€å°æƒé™åŸåˆ™
- **IPC éªŒè¯**: IPC æ¶ˆæ¯éªŒè¯å’Œè¿‡æ»¤

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

- **ç»„ä»¶æµ‹è¯•**: React ç»„ä»¶å•å…ƒæµ‹è¯•
- **æœåŠ¡æµ‹è¯•**: API æœåŠ¡å’Œæ•°æ®åº“æ“ä½œæµ‹è¯•
- **å·¥å…·å‡½æ•°**: çº¯å‡½æ•°å•å…ƒæµ‹è¯•

### 2. é›†æˆæµ‹è¯•

- **IPC é€šä¿¡**: ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é€šä¿¡æµ‹è¯•
- **æ•°æ®åº“**: æ•°æ®åº“æ“ä½œé›†æˆæµ‹è¯•
- **æ–‡ä»¶å¤„ç†**: æ–‡ä»¶ä¸Šä¼ å’Œè½¬æ¢é›†æˆæµ‹è¯•

### 3. E2E æµ‹è¯•

- **ç”¨æˆ·æµç¨‹**: å…³é”®ç”¨æˆ·æ“ä½œæµç¨‹æµ‹è¯•
- **è·¨å¹³å°**: macOS å’Œ Windows å¹³å°æµ‹è¯•

## éƒ¨ç½²ä¸åˆ†å‘

### 1. æ„å»ºé…ç½®

```json
{
  "build": {
    "appId": "com.knowlex.desktop",
    "productName": "Knowlex",
    "directories": {
      "output": "dist"
    },
    "files": ["dist-electron/**/*", "dist/**/*", "node_modules/**/*"],
    "mac": {
      "category": "public.app-category.productivity",
      "target": [
        {
          "target": "dmg",
          "arch": ["x64", "arm64"]
        }
      ]
    },
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": ["x64"]
        }
      ]
    },
    "publish": {
      "provider": "github",
      "owner": "knowlex",
      "repo": "knowlex-desktop"
    }
  }
}
```

### 2. è‡ªåŠ¨æ›´æ–°

- **Electron Updater**: é›†æˆè‡ªåŠ¨æ›´æ–°åŠŸèƒ½
- **å¢é‡æ›´æ–°**: æ”¯æŒå¢é‡æ›´æ–°å‡å°‘ä¸‹è½½é‡
- **æ›´æ–°ç­–ç•¥**: ç”¨æˆ·å¯é€‰æ‹©è‡ªåŠ¨æˆ–æ‰‹åŠ¨æ›´æ–°

## å…³é”®æ•°æ®æµç¨‹è¯´æ˜

### 1. ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant U as User (Renderer)
    participant M as Main Process
    participant W as Worker Threads
    participant AI as OpenAI API
    participant DB as SQLite/hnswsqlite

    U->>M: IPC: chat:send-message
    M->>DB: ä¿å­˜ç”¨æˆ·æ¶ˆæ¯

    alt RAG å¯ç”¨ä¸”åœ¨é¡¹ç›®ä¸­
        M->>DB: æŸ¥è¯¢é¡¹ç›®è®°å¿†
        M->>DB: å‘é‡æœç´¢ç›¸å…³æ–‡æ¡£
        opt é‡æ’å¯ç”¨
            M->>AI: è°ƒç”¨é‡æ’æ¨¡å‹
        end
        M->>M: æ„å»º RAG ä¸Šä¸‹æ–‡
    end

    M->>AI: å‘é€æ¶ˆæ¯ (æµå¼)
    AI-->>M: æµå¼å“åº”
    M-->>U: IPC: æµå¼æ•°æ®
    M->>DB: ä¿å­˜ AI å›å¤

    opt æ–°ä¼šè¯
        M->>AI: ç”Ÿæˆæ ‡é¢˜
        M->>DB: æ›´æ–°ä¼šè¯æ ‡é¢˜
    end
```

### 2. æ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant U as User (Renderer)
    participant M as Main Process
    participant W as Worker Threads
    participant FS as File System
    participant DB as SQLite/hnswsqlite

    U->>M: IPC: file:upload
    M->>FS: ä¿å­˜åŸå§‹æ–‡ä»¶
    M->>DB: ä¿å­˜æ–‡ä»¶å…ƒæ•°æ® (processing)
    M->>W: å‘é€æ–‡ä»¶å¤„ç†ä»»åŠ¡

    W->>FS: è¯»å–æ–‡ä»¶å†…å®¹
    W->>W: è½¬æ¢ä¸º PDF/A
    W->>FS: ä¿å­˜ PDF/A æ–‡ä»¶
    W->>W: æ™ºèƒ½æ–‡æœ¬åˆ†å—
    W->>AI: æ‰¹é‡å‘é‡åŒ–
    W->>DB: å­˜å‚¨å‘é‡æ•°æ®
    W->>DB: æ›´æ–°æ–‡ä»¶çŠ¶æ€ (completed)
    W-->>M: å¤„ç†å®Œæˆé€šçŸ¥
    M-->>U: IPC: æ–‡ä»¶çŠ¶æ€æ›´æ–°
```

### 3. å®‰å…¨è¾¹ç•Œå’Œæƒé™æ§åˆ¶

- **è¿›ç¨‹éš”ç¦»**: Renderer è¿›ç¨‹è¿è¡Œåœ¨æ²™ç®±ä¸­ï¼Œæ— æ³•ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®åº“
- **è·¯å¾„éªŒè¯**: Main è¿›ç¨‹å¯¹æ‰€æœ‰æ–‡ä»¶è·¯å¾„è¿›è¡Œ `path.isInside(userData)` éªŒè¯
- **API å¯†é’¥åŠ å¯†**: ä½¿ç”¨ Node.js crypto æ¨¡å—åŠ å¯†å­˜å‚¨ API å¯†é’¥
- **IPC æ¶ˆæ¯éªŒè¯**: æ‰€æœ‰ IPC æ¶ˆæ¯éƒ½ç»è¿‡ç±»å‹æ£€æŸ¥å’Œå‚æ•°éªŒè¯
- **æ•°æ®åº“è®¿é—®æ§åˆ¶**: åªæœ‰ Main è¿›ç¨‹å¯ä»¥è®¿é—®æ•°æ®åº“ï¼Œé˜²æ­¢å¹¶å‘å†²çª

### 4. æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

- **Worker çº¿ç¨‹**: é‡å‹æ–‡ä»¶å¤„ç†å’Œå‘é‡åŒ–åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»è¿›ç¨‹
- **æ‰¹é‡æ“ä½œ**: å‘é‡åŒ–å’Œæ•°æ®åº“å†™å…¥é‡‡ç”¨æ‰¹é‡å¤„ç†
- **è¿æ¥å¤ç”¨**: SQLite è¿æ¥æ± å’Œ HTTP è¿æ¥å¤ç”¨
- **å†…å­˜ç®¡ç†**: å¤§æ–‡ä»¶å¤„ç†ååŠæ—¶é‡Šæ”¾å†…å­˜ï¼Œä½¿ç”¨æµå¼å¤„ç†
- **ç´¢å¼•ä¼˜åŒ–**: å…³é”®æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•ï¼ŒFTS5 å®šæœŸä¼˜åŒ–
- **è™šæ‹Ÿæ»šåŠ¨**: å‰ç«¯é•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯

## å›½é™…åŒ–å®ç°

### 1. i18n æ¡†æ¶é›†æˆ

```typescript
// src/i18n/index.ts
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import Backend from 'i18next-fs-backend'
import LanguageDetector from 'i18next-browser-languagedetector'

import en from './locales/en.json'
import zh from './locales/zh.json'

i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    fallbackLng: 'en',
    debug: process.env.NODE_ENV === 'development',

    resources: {
      en: { translation: en },
      zh: { translation: zh },
    },

    interpolation: {
      escapeValue: false,
    },

    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
    },
  })

export default i18n
```

### 2. è¯­è¨€åŒ…ç»“æ„

```json
// src/i18n/locales/zh.json
{
  "common": {
    "save": "ä¿å­˜",
    "cancel": "å–æ¶ˆ",
    "delete": "åˆ é™¤",
    "edit": "ç¼–è¾‘",
    "loading": "åŠ è½½ä¸­..."
  },
  "sidebar": {
    "newChat": "æ–°å»ºèŠå¤©",
    "globalSearch": "å…¨å±€æœç´¢",
    "projects": "é¡¹ç›®",
    "chats": "èŠå¤©è®°å½•"
  },
  "chat": {
    "inputPlaceholder": "ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ",
    "uploadFile": "ä¸Šä¼ æ–‡ä»¶",
    "ragEnabled": "RAG æ£€ç´¢å·²å¯ç”¨",
    "ragDisabled": "RAG æ£€ç´¢å·²ç¦ç”¨"
  },
  "project": {
    "createProject": "åˆ›å»ºé¡¹ç›®",
    "projectName": "é¡¹ç›®åç§°",
    "projectDescription": "é¡¹ç›®æè¿°",
    "fileManager": "æ–‡ä»¶ç®¡ç†",
    "memoryKnowledge": "è®°å¿†ä¸çŸ¥è¯†"
  }
}
```

### 3. ç¿»è¯‘ Hook

```typescript
// src/i18n/hooks/useTranslation.ts
import { useTranslation as useI18nTranslation } from 'react-i18next'

export const useTranslation = (namespace?: string) => {
  const { t, i18n } = useI18nTranslation(namespace)

  const changeLanguage = (lng: string) => {
    i18n.changeLanguage(lng)
    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('language', lng)
  }

  return {
    t,
    currentLanguage: i18n.language,
    changeLanguage,
    languages: ['en', 'zh'],
  }
}
```

## æ–‡æ¡£ç³»ç»Ÿè®¾è®¡

### 1. æŠ€æœ¯æ–‡æ¡£ç»“æ„

```
docs/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ README.md                 # API æ¦‚è§ˆ
â”‚   â”œâ”€â”€ ipc-channels.md          # IPC é€šé“æ–‡æ¡£
â”‚   â”œâ”€â”€ database-schema.md       # æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ openai-service.md    # OpenAI æœåŠ¡ API
â”‚       â”œâ”€â”€ rag-service.md       # RAG æœåŠ¡ API
â”‚       â””â”€â”€ file-service.md      # æ–‡ä»¶æœåŠ¡ API
â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ overview.md              # æ¶æ„æ¦‚è§ˆ
â”‚   â”œâ”€â”€ data-flow.md             # æ•°æ®æµç¨‹
â”‚   â”œâ”€â”€ security.md              # å®‰å…¨æœºåˆ¶
â”‚   â””â”€â”€ performance.md           # æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ development/
â”‚   â”œâ”€â”€ setup.md                 # å¼€å‘ç¯å¢ƒæ­å»º
â”‚   â”œâ”€â”€ coding-standards.md      # ä»£ç è§„èŒƒ
â”‚   â”œâ”€â”€ testing.md               # æµ‹è¯•æŒ‡å—
â”‚   â””â”€â”€ deployment.md            # éƒ¨ç½²æŒ‡å—
â””â”€â”€ user/
    â”œâ”€â”€ quick-start.md           # å¿«é€Ÿå¼€å§‹
    â”œâ”€â”€ features/
    â”‚   â”œâ”€â”€ chat.md              # èŠå¤©åŠŸèƒ½
    â”‚   â”œâ”€â”€ projects.md          # é¡¹ç›®ç®¡ç†
    â”‚   â”œâ”€â”€ files.md             # æ–‡ä»¶ç®¡ç†
    â”‚   â””â”€â”€ settings.md          # è®¾ç½®é…ç½®
    â”œâ”€â”€ troubleshooting.md       # æ•…éšœæ’é™¤
    â””â”€â”€ faq.md                   # å¸¸è§é—®é¢˜
```

### 2. æ–‡æ¡£ç”Ÿæˆå·¥å…·

```typescript
// scripts/generate-docs.ts
import * as fs from 'fs'
import * as path from 'path'
import { generateApiDocs } from './api-doc-generator'
import { generateUserDocs } from './user-doc-generator'

async function generateDocs() {
  console.log('Generating documentation...')

  // ç”Ÿæˆ API æ–‡æ¡£
  await generateApiDocs()

  // ç”Ÿæˆç”¨æˆ·æ–‡æ¡£
  await generateUserDocs()

  // ç”Ÿæˆç›®å½•ç´¢å¼•
  await generateIndex()

  console.log('Documentation generated successfully!')
}

generateDocs().catch(console.error)
```

è¿™ä¸ªæŠ€æœ¯è®¾è®¡æ–‡æ¡£æ¶µç›–äº† Knowlex æ¡Œé¢åº”ç”¨çš„å®Œæ•´æŠ€æœ¯æ¶æ„ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›äº†æ¸…æ™°çš„å®ç°æŒ‡å¯¼ã€‚è®¾è®¡è€ƒè™‘äº†æ€§èƒ½ã€å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒç­‰å¤šä¸ªæ–¹é¢ï¼Œå¹¶æ ¹æ®åé¦ˆæ„è§è¿›è¡Œäº†é‡è¦ä¼˜åŒ–ï¼š

- é‡‡ç”¨ hnswsqlite æ›¿ä»£ LanceDBï¼Œç®€åŒ–éƒ¨ç½²å’Œç»´æŠ¤
- å¼•å…¥ Worker çº¿ç¨‹å¤„ç†é‡å‹ä»»åŠ¡ï¼Œæå‡å“åº”æ€§
- åŠ å…¥é‡æ’æ¨¡å‹æ”¯æŒï¼Œæå‡ RAG æ£€ç´¢è´¨é‡
- ä¼˜åŒ–æ–‡æœ¬åˆ†å—ç­–ç•¥ï¼Œæ›´å¥½æ”¯æŒä¸­è‹±æ–‡æ··åˆå†…å®¹
- å®Œå–„å®‰å…¨æœºåˆ¶å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- é›†æˆå›½é™…åŒ–æ”¯æŒï¼Œæä¾›ä¸­è‹±æ–‡ç•Œé¢
- å»ºç«‹å®Œæ•´çš„æ–‡æ¡£ç³»ç»Ÿï¼Œæ”¯æŒæŠ€æœ¯å’Œç”¨æˆ·æ–‡æ¡£
